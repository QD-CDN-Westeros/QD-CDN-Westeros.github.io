/* Lugia - 21/03/2022 18:16:24 GMT */
"use strict";var imported=document.createElement("script");imported.src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js";document.head.appendChild(imported);function checkoutSteps(){$(window).on("hashchange",function(e){if(window.location.hash=="#/cart"){$(".mz-header__checkout--steps li").removeClass("active");$("#sacola").addClass("active")}else if(window.location.hash=="#/email"||window.location.hash=="#/profile"){$(".mz-header__checkout--steps li").removeClass("active");$("#sacola").addClass("active");$("#identificacao").addClass("active")}else if(window.location.hash=="#/payment"){$(".mz-header__checkout--steps li").removeClass("active");$("#sacola").addClass("active");$("#identificacao").addClass("active");$("#pagamento").addClass("active")}else if(window.location.hash=="/orderPlaced"){$(".mz-header__checkout--steps li").removeClass("active");$("#sacola").addClass("active");$("#identificacao").addClass("active");$("#pagamento").addClass("active");$("#confirmacao").addClass("active")}})}function checkText(){$(".newsletter-label").append("<span> "+'Estou de acordo com o uso de dados conforme <a href="#">Políticade Privacidade</a> do site</span>');$(".opt-in-newsletter, .newsletter-text").hide()}function checkOptin(){if($("#opt-in-newsletter").is(":checked")){$("#go-to-shipping").removeAttr("disabled")}else{$("#go-to-shipping").attr("disabled","disabled")}}function bindOptinFunc(){$("#opt-in-newsletter").on("change",function(){if($(this).is(":checked")){$("#go-to-shipping").removeAttr("disabled")}else{$("#go-to-shipping").attr("disabled","disabled")}})}$(document).ready(function(){checkText();waitForVtexJs();waitForMask();updateBDDate();bindOptinFunc()});$(window).on("hashchange",function(){waitForMask();checkOptin()});function waitForMask(){var breaker=0;var maskInterval=setInterval(function(){breaker++;if($.fn.mask&&typeof $.fn.mask==="function"){renderBDField();clearInterval(maskInterval)}if(breaker>20){clearInterval(maskInterval)}},300)}function updateBDDate(){$("#go-to-shipping").on("click",function(e){if(window.userInputDate||checkIfDateIsValid($("#client-birthDatemz").val())){sendBD()}else{e.preventDefault();$(".birthDatemz-error").show()}})}function checkIfDateIsValid(a){try{var a=a.split("/");var newDate=[a[2],a[1],a[0]].join("/");for(var i=0;i<=2;i++){if(!a[i]){return false}}var dt=new Date(newDate);return new Date(dt.getTime()-dt.getTimezoneOffset()*6e4).toISOString()}catch(e){return false}}function sendBD(){try{var _vtexjs,_vtexjs$checkout,_vtexjs$checkout$orde,_vtexjs2,_vtexjs2$checkout,_vtexjs2$checkout$ord;var value=window.userInputDate?String(window.userInputDate):checkIfDateIsValid($("#client-birthDatemz").val());window.userInputDate=null;var email=vtexjs.checkout.orderForm.clientProfileData.email?vtexjs.checkout.orderForm.clientProfileData.email:$("#client-email").val();var orderFormId=vtexjs.checkout.orderForm.orderFormId;var birthDate=value;var canEditData=(_vtexjs=vtexjs)===null||_vtexjs===void 0?void 0:(_vtexjs$checkout=_vtexjs.checkout)===null||_vtexjs$checkout===void 0?void 0:(_vtexjs$checkout$orde=_vtexjs$checkout.orderForm)===null||_vtexjs$checkout$orde===void 0?void 0:_vtexjs$checkout$orde.canEditData;var loggedIn=(_vtexjs2=vtexjs)===null||_vtexjs2===void 0?void 0:(_vtexjs2$checkout=_vtexjs2.checkout)===null||_vtexjs2$checkout===void 0?void 0:(_vtexjs2$checkout$ord=_vtexjs2$checkout.orderForm)===null||_vtexjs2$checkout$ord===void 0?void 0:_vtexjs2$checkout$ord.loggedIn;var url,body;localStorage.setItem("lsVal",JSON.stringify({birthDate:value,email:email}));localStorage.setItem("lsValDate",(new Date).toISOString());if(canEditData&&loggedIn&&window.mdid){url="/api/io/safedata/CL/documents/"+window.mdid;body={birthDate:birthDate}}else{url="/api/io/safedata/CL/documents?_orderFormId="+orderFormId;body={email:email,birthDate:birthDate}}$.ajax({url:url,global:false,headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=UTF-8"},type:"PATCH",data:JSON.stringify(body)})}catch(e){console.warn("An error occurred in sendBD: "+e.message)}}function waitForVtexJs(){var breaker=0;var vtexJsInterval=setInterval(function(){breaker++;if(vtexjs&&vtexjs.checkout&&vtexjs.checkout.orderForm&&vtexjs.checkout.orderForm){if(vtexjs.checkout.orderForm.clientProfileData&&vtexjs.checkout.orderForm.clientProfileData.email){clearInterval(vtexJsInterval);getBDDate()}}if(breaker>20){clearInterval(vtexJsInterval)}},400)}function getBDDate(){var _vtexjs3,_vtexjs3$checkout,_vtexjs3$checkout$ord,_vtexjs4,_vtexjs4$checkout,_vtexjs4$checkout$ord;if(window.userEmail){return}var email=vtexjs.checkout.orderForm.clientProfileData.email;var canEditData=(_vtexjs3=vtexjs)===null||_vtexjs3===void 0?void 0:(_vtexjs3$checkout=_vtexjs3.checkout)===null||_vtexjs3$checkout===void 0?void 0:(_vtexjs3$checkout$ord=_vtexjs3$checkout.orderForm)===null||_vtexjs3$checkout$ord===void 0?void 0:_vtexjs3$checkout$ord.canEditData;var loggedIn=(_vtexjs4=vtexjs)===null||_vtexjs4===void 0?void 0:(_vtexjs4$checkout=_vtexjs4.checkout)===null||_vtexjs4$checkout===void 0?void 0:(_vtexjs4$checkout$ord=_vtexjs4$checkout.orderForm)===null||_vtexjs4$checkout$ord===void 0?void 0:_vtexjs4$checkout$ord.loggedIn;if(email){window.userEmail=email}if(!canEditData){return}if(!loggedIn){getDateFromLS();return}$.ajax({url:"/api/io/safedata/CL/search?email="+email+"&_fields=birthDate,id",type:"GET",global:false,headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=UTF-8"}}).done(function(resp){if(!resp||!resp.length||!resp[0].birthDate){return}var bd=resp[0].birthDate;var date=new Date(bd);var localeDate=new Date(date.getTime()+date.getTimezoneOffset()*6e4).toLocaleDateString("pt-br");var input=$("#client-birthDatemz");window.mdid=resp[0].id?resp[0].id:null;if(input.length){input.val(localeDate)}else{window.userDefaultDate=localeDate}})}function getDateFromLS(){try{var email=vtexjs.checkout.orderForm.clientProfileData.email;var lsValObj=JSON.parse(localStorage.getItem("lsVal"));var lsVal=lsValObj.birthDate;var lsValDateObj=new Date(lsVal);if(!lsVal||!email||email!=lsValObj.email)return;var lsValDate=localStorage.getItem("lsValDate");var now=new Date;var lsDate=new Date(lsValDate);if(now<lsDate.setDate(lsDate.getDate()+1)){var ldsVal=new Date(lsValDateObj.getTime()+lsValDateObj.getTimezoneOffset()*6e4).toLocaleDateString("pt-br");window.userInputDate=lsVal;var input=$("#client-birthDatemz");if(input.length){input.val(ldsVal)}else{window.userDefaultDate=ldsVal}}else{localStorage.removeItem("lsVal");localStorage.removeItem("lsValDate")}}catch(e){console.warn("An error occurred when recovering information from localstorage: "+e.message)}}function renderBDField(){var clemail=$(".box-client-info .client-email");if(clemail.length&&!$(".client-birthDatemz").length){var p=$('<p class="client-birthDatemz input text required"></p>');var label=$('<label for="client-birthDatemz">Data de Aniversário</label>');var error=$('<span style="display:none" class="help error birthDatemz-error">Por favor, verifique se sua data está correta.</span>');var input=$('<input type="text" id="client-birthDatemz" class="input-xlarge" name="birthDatemz" placeholder="00/00/0000" >').on("input",function(e){}).on("blur focusout",function(e){window.userInputDate=null;var date=checkIfDateIsValid(e.target.value);if(!date){$(".birthDatemz-error").show();return}window.userInputDate=date}).on("focus",function(){$(".birthDatemz-error").hide()});input.mask("00/00/0000");if(window.userDefaultDate){input.val(window.userDefaultDate)}var small=$("<small>*O campo deve ser preenchido apenas com números.</small>");p.append(label,input,error,small);$(clemail).after(p)}}function addFieldLinxIntegration(){var divChaordic='\x3c!-- Chaordic Top banner --\x3e\n  <div chaordic="top"></div>\n  \x3c!-- Chaordic Top banner --\x3e';$(".summary-template-holder").after(divChaordic);var divChaordic2='\x3c!-- Chaordic Top banner --\x3e\n  <div chaordic="middle"></div>\n  \x3c!-- Chaordic Top banner --\x3e';$(".mzfooter__doubts").after(divChaordic2);var divChaordic3='\x3c!-- Chaordic Top banner --\x3e\n  <div chaordic="bottom"></div>\n  \x3c!-- Chaordic Top banner --\x3e';$(".checkout-container.row-fluid ").after(divChaordic3)}$(window).load(function(){checkoutSteps();addFieldLinxIntegration()});