/* Quatro Digital - Smart Research // 4.7 // Carlos Vinicius // Todos os direitos reservados */
(function(b){if("function"!==typeof b.fn.QD_SmartResearch){var g=function(b,d){if("object"===typeof console&&"undefined"!==typeof console.error&&"undefined"!==typeof console.info&&"undefined"!==typeof console.warn){var f;"object"===typeof b?(b.unshift("[Smart Research]\n"),f=b):f=["[Smart Research]\n"+b];if("undefined"===typeof d||"alerta"!==d.toLowerCase()&&"aviso"!==d.toLowerCase())if("undefined"!==typeof d&&"info"===d.toLowerCase())try{console.info.apply(console,f)}catch(g){try{console.info(f.join("\n"))}catch(h){}}else try{console.error.apply(console,
f)}catch(g){try{console.error(f.join("\n"))}catch(h){}}else try{console.warn.apply(console,f)}catch(g){try{console.warn(f.join("\n"))}catch(h){}}}};window._QuatroDigital_InfinityScroll=window._QuatroDigital_InfinityScroll||{};var d=window._QuatroDigital_InfinityScroll;window._QuatroDigital_SmartResearch=window._QuatroDigital_SmartResearch||{};var F=window._QuatroDigital_SmartResearch,G=b("");b(document);var H=b("html,body"),h=b("body");b.fn.QD_SmartResearch=function(D){function E(){if(!c.mergeMenu)return!1;
var a=I;a.insertAfter(c.insertMenuAfter);x(a)}function f(){if(c.mergeMenuList){var a=0;l.find("h3,h4").each(function(){var e=r.find("h3,h4").eq(a).next("ul");e.insertAfter(b(this));x(e);a++})}}function x(a){a.find("a").each(function(){var a=b(this);a.text(z(a.text()))})}function y(a){a=a.getParent("fieldset");var b=a.parent();a.find("input:checked").length?(a.addClass("qd-sr-filtered"),b.addClass("qd-sr-on-"+a.attr("data-qd-class"))):(a.removeClass("qd-sr-filtered"),b.removeClass("qd-sr-on-"+a.attr("data-qd-class")))}
function J(){n.fieldsetCount=0;n.tmpCurrentLabel={};l.find("fieldset").each(function(){var a=b(this),e=a.find("label"),d=(a.find("h5:first").text()||"").toLowerCase().replaceSpecialChars().replace(/\s/g,"-"),f="filtro_"+d;n[f]={};1>e.length?a.hide():(a.find("a.ver-filtros").length&&a.addClass("qd-sr-show-more-results"),a.addClass(f).attr("data-qd-class",d),e.each(function(e){var d=b(this),k=d.find("input").val()||d.siblings("input#"+(d.attr("for")||g("O label n\u00e3o tem 'for'","alerta")||"_")).val()||
"",h="sr_"+k.toLowerCase().replaceSpecialChars().replace(/\s/g,"-");n.tmpCurrentLabel={fieldsetParent:[a,f],elem:d};n[f][e.toString()]={className:h,title:k};d.addClass(h).attr({title:k,index:e});c.labelCallback(n)}),n.fieldsetCount++)})}function A(a,c){y(a);var k=c?v:"&"+(a.attr("rel")||"");q.fadeTo(300,.6);d.searchUrl+=k;d.searchUrl=d.searchUrl.replace(/PageNumber=[0-9]*/,"PageNumber=1");d.currentStatus=!1;"false"!=(a.attr("data-sr-exec-ajax")||"")&&(t=b.ajax({url:d.searchUrl,success:B,error:C}));
k=a.parent();k.is("label")||(k=a.attr("id")||g("O input n\u00e3o possui ID")||"",k=a.siblings("[for='"+k+"']"));k.addClass("sr_selected");a.addClass("qd_sr_selected")}function B(a){q.fadeTo(300,0,function(){b(this).hide()});K(b(a));m.requests++;c.ajaxCallback(m);H.animate({scrollTop:c.filterScrollTop(L||{top:0,left:0})},500,function(){w||(d.currentStatus=!0)})}function C(a,e){"abort"!==e&&(q.fadeTo(300,0,function(){b(this).hide()}),alert(c.filterErrorMsg),g("Houve um erro ao tentar fazer a requisi\u00e7\u00e3o da p\u00e1gina com filtros."),
d.currentStatus=!0)}function K(a){w=!0;if(!c.authorizeUpdate(m))return!1;var e=a.filter(c.shelfClass);a=p.find(c.shelfClass);(0<a.length?a:c.emptySearchElem).slideUp(600,function(){b(this).remove();c.usePopup?b(".boxPopUp2").vtexPopUp2():c.emptySearchElem.remove();0<e.length?(e.hide(),p.append(e),c.shelfCallback(),b(window).trigger("QuatroDigital.sr_insertedCallback"),e.slideDown(600,function(){w=!1;d.currentStatus=!0;b(window).trigger("QuatroDigital.sr_shelfCallback")}),m.isEmpty=!1,h.removeClass("qd-sr-empty-search")):
(m.isEmpty=!0,c.usePopup?c.emptySearchElem.addClass("freeContent autoClose ac_"+c.popupAutoCloseSeconds).vtexPopUp2().stop(!0).show():(p.append(c.emptySearchElem),c.emptySearchElem.show().css("height","auto").fadeTo(300,.2,function(){c.emptySearchElem.fadeTo(300,1)})),c.emptySearchCallback(m),h.addClass("qd-sr-empty-search"))})}function M(a){var b,c,d;b=a.parent();d=!1;b.is("label")||(b=a.attr("id")||""+g("O input n\u00e3o possui ID"),b=a.siblings("[for='"+b+"']"),d=!0);c=b.text();c=z(c);d?b.text(c):
b.text(c).prepend(a)}function z(a){return a.replace(/\([0-9]+\)/ig,function(a){return""})}var u=b(this),N={loadContent:".prateleira[id^=ResultItems]",shelfClass:".prateleira",filtersMenu:".search-multiple-navigator",linksMenu:".search-single-navigator",menuDepartament:".navigation-tabs .menu-departamento",mergeMenu:!0,insertMenuAfter:".search-multiple-navigator h3:first",emptySearchElem:b('<div class="vtexsr-emptySearch"></div>'),elemLoading:'<div id="scrollLoading">Carregando ... </div>',emptySearchMsg:"<h3>Esta combina\u00e7\u00e3o de filtros n\u00e3o retornou nenhum resultado!</h3>",
filterErrorMsg:"Houve um erro ao tentar filtrar a p\u00e1gina!",usePopup:!1,showLinks:!0,mergeMenuList:!0,popupAutoCloseSeconds:3,isSmartCheckout:!0,invertOrder:!1,filterScrollTop:function(a){return a.top-20},callback:function(){},shelfCallback:function(){},ajaxCallback:function(){},emptySearchCallback:function(){},authorizeUpdate:function(){return!0},labelCallback:function(a){},initChangeCallback:function(a){},endChangeCallback:function(a){}},c=b.extend({},N,D);b(c.elemLoading);var v="",w=!1,p=b(c.loadContent),
l=b(c.filtersMenu),n={},m={requests:0,filters:0,isEmpty:!1};F.ajaxCallbackObj=m;d.searchUrl=d.searchUrl||function(){var a,c,d;b("script:not([src])").each(function(){c=b(this)[0].innerHTML;d=/\/buscapagina\?.+&PageNumber=/i;if(-1<c.search(/\/buscapagina\?/i))return a=d.exec(c),!1});if("undefined"!==typeof a&&"undefined"!==typeof a[0])return a[0];g("N\u00e3o foi poss\u00edvel localizar a url de busca da p\u00e1gina.\n Tente adicionar o .js ao final da p\u00e1gina. \n[M\u00e9todo: getSearchUrl]");return""}();
if(1>u.length)return g("Nenhuma op\u00e7\u00e3o de filtro encontrada","Aviso"),c.showLinks&&b(c.linksMenu).css("visibility","visible").show(),"object"===typeof d.buttonToTop&&d.buttonToTop instanceof b&&d.buttonToTop.trigger("click"),u;if(1>p.length)return g("Elemento para destino da requisi\u00e7\u00e3o n\u00e3o foi encontrado \n ("+p.selector+")"),!1;1>l.length&&g("O menu de filtros n\u00e3o foi encontrado \n ("+l.selector+")");var r=b(c.linksMenu),q=b('<div class="vtexSr-overlay"></div>'),I=b(c.menuDepartament),
L=p.offset(),t=null;c.emptySearchElem.append(c.emptySearchMsg);p.before(q);c.isSmartCheckout?c.mergeMenu&&r.insertAfter(c.insertMenuAfter):h.hasClass("departamento")?E():(h.hasClass("categoria")||h.hasClass("resultado-busca"))&&f();(function(){l.length&&(c.invertOrder?r.insertBefore(l):(r.hide(),l.show()));J();u.each(function(){var a=b(this),e=a.parent();e.is("label")||(e=a.siblings("[for='"+(a.attr("id")||g("O input n\u00e3o possui ID")||"")+"']"));a.is(":checked")&&(v+="&"+(a.attr("rel")||""),e.addClass("sr_selected"),
a.addClass("qd_sr_selected"));M(a);e.append('<span class="sr_box"></span><span class="sr_box2"></span>');a.bind("change.qd_sr_change",function(e){if(!1===c.initChangeCallback.call(this,e))return!1;null!==t&&t.abort();d.currentPage=2;d.pages=9999999999999;d.moreResults=!0;if(a.is(":checked"))A(a);else{y(a);var f=a.attr("rel")||"";q.fadeTo(300,.6);d.searchUrl=d.searchUrl.replace("&"+f,"");d.searchUrl=d.searchUrl.replace(/PageNumber=[0-9]*/,"PageNumber=1");d.currentStatus=!1;"false"!=(a.attr("data-sr-exec-ajax")||
"")&&(t=b.ajax({url:d.searchUrl,success:B,error:C}));a.parent().removeClass("sr_selected");a.removeClass("qd_sr_selected")}m.filters=u.filter(":checked").length;c.endChangeCallback.call(this,e)})});""!==v&&A(G,!0)})();c.callback();l.css("visibility","visible")}}})(jQuery);