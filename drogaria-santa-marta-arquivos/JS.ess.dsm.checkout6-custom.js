/* davids - 30/12/2020 16:36:02 GMT-0200 */
/*!  */
var Checkout={__sendRecipe:function(e){return function(){""!==e.value&&$.ajax({type:"POST",url:"/api/dataentities/FR/documents",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify({name:"user",gender:"gender",age:"20",email:"user@gmail.com",phone:"1111-1111",messeger:"user"}),error:function(){alert("Não foi possível enviar seu formulário, por favor tente novamente ou entre em contato por telefone."),loading.slideUp((function(){$(this).remove()}))}}).done((function(t){var n=t.DocumentId,o=new FormData,a=e.files[0];a.name=a.name.replace(/ /g,""),o.append(a.name,a);var c=e.dataset.name+" "+e.dataset.sku+": "+t.Href+"/recipe/attachments/"+a.name,r=document.querySelector("#cart-note");r.innerHTML+=c+String.fromCharCode(13)+String.fromCharCode(13),r.value=r.innerText,$("#cart-note").blur(),$.ajax({type:"POST",url:"/api/dataentities/FR/documents/"+n+"/recipe/attachments",crossDomain:!0,data:o,processData:!1,contentType:!1,mimeType:"multipart/form-data",headers:{Accept:"application/vnd.vtex.ds.v10+json"}}).done((function(t){e.nextElementSibling.innerHTML="Receita Enviada",e.nextElementSibling.classList.add("is--active"),Checkout.__checkRecipe()}))}))}},__addButton:function(){var e=document.querySelectorAll("#cartLoadedDiv .cart-items tbody > tr.product-item"),t=!0;return e.length?0==e[0].offsetTop?setTimeout(Checkout.__addButton,2e3):void e.forEach((function(e){fetch("/api/catalog_system/pub/products/search?fq=skuId:"+e.dataset.sku).then((function(e){return e.json()})).then((function(n){if(void 0!==n[0]["Medicamento Controlado"]){t&&(Checkout.__textRecipe(),t=!1),document.querySelector("#cart-to-orderform").classList.add("mz-cart-procced");var o=e.querySelector(".product-name").innerText,a=document.createElement("input");a.setAttribute("type","file"),a.setAttribute("required","required"),a.setAttribute("accept",".pdf,.png,.jpg,.doc,.gif"),a.setAttribute("data-sku",e.dataset.sku),a.setAttribute("data-name",o),a.classList.add("inputFile"),a.style.display="none",a.addEventListener("change",Checkout.__sendRecipe(a));var c=document.createElement("button");c.classList.add("recipe"),c.innerText="Enviar Receita",c.addEventListener("click",(function(){a.click()}),!1);var r=document.createElement("div");r.classList.add("mz-input-file"),r.style.top=36+e.offsetTop+"px",console.log(e.offsetTop),console.dir(e),r.append(a),r.append(c),document.querySelector("#cartLoadedDiv").append(r),console.log(e)}}))})):setTimeout(Checkout.__addButton,1e3)},__checkRecipe:function(){for(var e=document.querySelectorAll(".mz-input-file button"),t=0;t<e.length;t++)if(!e[t].classList.contains("is--active"))return;document.querySelector("#cart-to-orderform").classList.remove("mz-cart-procced")},__isProcced:function(){document.querySelector(".btn-place-order-wrapper").addEventListener("click",(function(){document.querySelector("#cart-to-orderform").classList.contains("mz-cart-procced")&&alert("é necessário enviar as receitas!")}))},__textRecipe:function(){var e=document.createElement("div");e.innerHTML="<h1>Envio de receitas</h1> <p>Você pode enviar suas receitas nos seguintes formatos: JPG, PNG, Gif, DOC, PDF.</p>",e.classList.add("mz-recipe-info"),window.innerWidth>768?document.querySelector(".checkout-container > .cart-template").append(e):document.querySelector(".checkout-container > .cart-template .summary-totalizers").prepend(e)},init:function(){Checkout.__addButton(),Checkout.__isProcced()}};"loading"!==document.readyState?Checkout.init():document.addEventListener("DOMContentLoaded",(function(){Checkout.init()})),$(window).load((function(){}));