!function(){const e={formatReal:function(e){return null===e?"":(0!=e&&(e/=100),e.toLocaleString("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).replace(".",","))},formatEstimate:function(e,t){return e.indexOf("bd")>0&&e.indexOf("1bd")<0?e.replace("bd"," dias"):0===e.indexOf("1bd")?e.replace("bd"," dia"):e.indexOf("h")>0?e.replace("h"," horas"):0===e.indexOf("0")?0!==t.length?"disponível somente para retirada":"indisponível":void 0},formatStoreName:function(e){if(e.indexOf("-")>0)return e.replace(/[^a-zA-Z0-9\.]+/g," ")},changeLocalStorage:function(e){localStorage.setItem("activeDeliveryChannel",e),localStorage.setItem("aditionalShippingData",JSON.stringify({activeTab:e,isScheduledDeliveryActive:!0,originComponent:"omnishipping",selectedLeanShippingOption:"CHEAPEST"}))},getMainLogistic:function(e,t){try{return e.shippingData.logisticsInfo.map((({itemIndex:e,slas:n})=>{const i=n.find((e=>e.pickupPointId==(t||null))),a=t?"pickup-in-point":"delivery";return{itemIndex:e,selectedSla:i.id,selectedDeliveryChannel:a}}))}catch{return null}},getLogisticSpecific:function(e,t,n){try{return e.shippingData.logisticsInfo.map((({itemIndex:e,slas:i})=>{if(e===t){const t=i.find((e=>e.id==(n||null))),a=n?"delivery":"pickup-in-point";return{itemIndex:e,selectedSla:t.id,selectedDeliveryChannel:a}}}))}catch{return null}},changeToPickup:function(t,n){let i=vtexjs.checkout.orderForm.shippingData.address.postalCode;vtexjs.checkout.sendAttachment("shippingData",{address:{country:"BRA",postalCode:i,addressType:"residential"}}).done((function(a){const o=a.shippingData.logisticsInfo.map((({itemIndex:e,slas:i})=>{if(e===parseInt(t)){const t=i.find((e=>e.pickupPointId==n));return{itemIndex:e,addressId:(-1*(new Date).getTime()).toString(),selectedSla:t.id,selectedDeliveryChannel:"pickup-in-point"}}})).filter((function(e){if(void 0!==e)return e}));vtexjs.checkout.sendAttachment("shippingData",{address:{country:"BRA",postalCode:i,addressType:""},logisticsInfo:o},null).done((function(){e.changeLocalStorage("pickup-in-point"),location.reload()}))}))},changeToDelivery:function(t,n){return vtexjs.checkout.getOrderForm().then((i=>{const a=e.getLogisticSpecific(i,parseInt(t),n).filter((function(e){if(void 0!==e)return e}));vtexjs.checkout.sendAttachment("shippingData",{address:{country:"BRA",postalCode:vtexjs.checkout.orderForm.shippingData.address.postalCode,addressType:"residential"},logisticsInfo:a},null).done((function(){e.changeLocalStorage("delivery"),location.reload()}))}))},verifyLimit:function(e){let t=$.ajax({url:"/api/catalog_system/pub/products/search?fq=productId:"+e,method:"GET",async:!1});return JSON.parse(t.responseText)[0].items[0].sellers[0].commertialOffer.AvailableQuantity}},t={init:function(){t.bringInfo()},bringInfo:function(){vtexjs.checkout.getOrderForm().done((function(e){const n=vtexjs.checkout.orderForm.items,i=vtexjs.checkout.orderForm.shippingData.logisticsInfo,a=$(".cart-loading"),o=$(".cart"),r=$(".cart-empty");n.length>0?(t.buildCart(n,i),o.addClass("display-cart"),r.removeClass("display-empty-cart"),a.hide()):(o.removeClass("display-cart"),r.addClass("display-empty-cart"),a.hide())}))},buildCart:function(e,i){let a,o,r=[];e.map((function(e,t){const n=i.filter((function(e){if(e.itemIndex===t)return e}));n[0].slas.length>0?(a=n[0].slas.filter((function(e){if("pickup-in-point"===e.deliveryChannel)return e})),o=n[0].slas.filter((function(e){if("delivery"===e.deliveryChannel)return e}))):(a=[],o=[]);const s=n[0].slas.filter((function(e){if(e.id===n[0].selectedSla)return e}));let d;d=s.length>0?s[0].shippingEstimate:"0",r.push({index:n[0].itemIndex,productID:e.productId,skuid:e.id,refid:e.productRefId,name:e.name,link:e.detailUrl,image:e.imageUrl,price:e.price,qtd:e.quantity,hasPickup:a.length,hasDelivery:o.length,selectedDelivery:n[0].selectedDeliveryChannel,selectedSla:n[0].selectedSla,slas:n[0].slas,estimate:d,measure:e.measurementUnit,unit:e.unitMultiplier})})),t.addHTML(r),n.init()},addHTML:function(n){const i=$(".mz-cart .cart__table table");i.html(""),i.append("\n        <tr>\n          <th>Produto</th>\n          <th>Entrega</th>\n          <th>Qtd.</th>\n          <th>Valor</th>\n          <th></th>\n        </tr>\n      "),n.map((function(n,a){i.append(`\n        <tr data-index="${a}" data-productid="${n.productID}">\n          <td>\n            <div class="cart__table--name">\n              <a href="${n.link}"><img src="${n.image}" /></a>\n              <h2><a href="${n.link}">${n.name}</a></h2>\n            </div>\n          </td>\n          <td>\n            <p>${e.formatEstimate(n.estimate,n.slas)}</p>\n          </td>\n          <td>\n            <div class="cart__table--qtd">\n              <span class="btn-qtd minus">-</span>\n              <input type="text" name="qtd" value="${n.qtd}" />\n              <span class="btn-qtd plus">+</span>\n            </div>\n            ${t.returnMeasure(n)}\n          </td>\n          <td>\n            <p><strong>${e.formatReal(n.price)}</strong></p>\n          </td>\n          <td>\n            <button data-index="${a}" class="cart__table--remove"></button>\n          </td>\n        </tr>\n        <tr data-index="${a}" class="cart__table--entrega ${"0"===n.estimate&&0===n.slas.length?"indisponivel":""}">\n          <td colspan="5">\n            <h4>Opções de entrega</h4>\n            <div class="cart__table--entrega--options">\n              <ul>\n                ${t.returnLogistInfo(n)}\n              </ul>\n            </div>\n          </td>\n        </tr>\n        `)}))},returnMeasure:function(e){return"un"!==e.measure?`\n        <div class="cart__table--medida">\n          <p>${e.unit+e.measure}</p>\n        </div>\n        `:""},returnLogistInfo:function(t){let i=[];if(0!==t.hasPickup&&0!==t.hasDelivery?i.push({id:"delivery"},{id:"pickup-in-point"}):0!==t.hasPickup&&0===t.hasDelivery?i.push({id:"pickup-in-point"}):i.push({id:"delivery"}),t.slas.length>0){const o=t.slas.filter((function(e){if("pickup-in-point"===e.deliveryChannel)return e})),r=t.slas.filter((function(e){if("delivery"===e.deliveryChannel)return e})),s=t.slas.filter((function(e){if(e.id===t.selectedSla)return e}));return n.changeDelivery(o,r,t.index),1===t.slas.length&&"pickup-in-point"===t.slas[0].deliveryChannel?`\n            <li data-info="pickup-in-point">\n              <label>\n                <input type="radio" name="select-sla-${t.index}" data-itemid="${t.productID}" data-itemindex="${t.index}" ${"pickup-in-point"===t.selectedDelivery?'checked="checked"':""} />\n                <span class="checkmark"></span>\n              </label>\n              <div class="description">\n                <p><strong>Retirar na loja</strong></p>\n                <p class="prazo"><strong>Prazo: </strong>${e.formatEstimate(t.estimate,t.slas)} após o pagamento</p>\n                ${a("pickup-in-point")}\n              </div>\n            </li>\n            `:i.map((function(n){let i,d;return i="delivery"===n.id?"Receber em casa":"Retirar na loja",d="delivery"===n.id?"pickup-in-point"!==s[0].deliveryChannel?s[0].shippingEstimate:r[0].shippingEstimate:s.length>0?"delivery"!==s[0].deliveryChannel?s[0].shippingEstimate:o[0].shippingEstimate:"0",`\n          <li data-info="${n.id}">\n            <label>\n              <input type="radio" name="select-sla-${t.index}" data-itemid="${t.productID}" data-itemindex="${t.index}" ${t.selectedDelivery===n.id?'checked="checked"':""} />\n              <span class="checkmark"></span>\n            </label>\n            <div class="description">\n              <p><strong>${i}</strong></p>\n              <p class="prazo"><strong>Prazo: </strong>${e.formatEstimate(d,t.slas)} após o pagamento</p>\n              ${a(n.id)}\n            </div>\n          </li>\n          `})).join("");function a(i){if(n.openModal(t.slas,t,t.index),"pickup-in-point"===i){if(o.length>1){let n,i,a,r,d,c;return s.length>0&&"pickup-in-point"===s[0].deliveryChannel?(n=s[0].pickupStoreInfo.address.addressId,i=s[0].pickupStoreInfo.address.street,a=s[0].pickupStoreInfo.address.number,r=s[0].pickupStoreInfo.address.neighborhood,d=s[0].pickupStoreInfo.address.city,c=s[0].pickupStoreInfo.address.state):(n=o[0].pickupStoreInfo.address.addressId,i=o[0].pickupStoreInfo.address.street,a=o[0].pickupStoreInfo.address.number,r=o[0].pickupStoreInfo.address.neighborhood,d=o[0].pickupStoreInfo.address.city,c=o[0].pickupStoreInfo.address.state),`\n              <div class="local">\n                <p><strong>${e.formatStoreName(n)}</strong></p>\n                <p>${i} - nº ${a} - ${r}, ${d} - ${c}</p>\n              </div>\n              <div class="more">\n                <a id="pickup-in-point_${t.index}">Ver outras opções de retirada</a>\n              </div>\n              `}return`\n              <div class="local">\n                <p><strong>${e.formatStoreName(o[0].pickupStoreInfo.address.addressId)}</strong></p>\n                <p>${o[0].pickupStoreInfo.address.street} - nº ${o[0].pickupStoreInfo.address.number} - ${o[0].pickupStoreInfo.address.neighborhood}, ${o[0].pickupStoreInfo.address.city} - ${o[0].pickupStoreInfo.address.state}</p>\n              </div>\n              `}return r.length>1?`\n              <div class="more">\n                <a id="delivery_${t.index}">Ver outras opções de entrega</a>\n              </div>\n              `:""}}return'\n        <li data-info="indisponivel">\n          <i class="fa fa-exclamation-triangle"></i>\n          <span>Este produto não está disponível para esse endereço</span>\n        </li>\n        '}};$(document).ready((function(){t.init()}));const n={init:function(){n.cart(),n.productTimeout(),n.closeOrder()},productTimeout:function(){window.productUpdate={}},cart:function(){$(".cart__table table tr:not(.cart__table--entrega)").each((function(){n.removeItem($(this)),n.addQtd($(this)),n.removeQtd($(this)),n.changeQtd($(this))}))},removeItem:function(e){e.find(".cart__table--remove").on("click",(function(){$(".cart-loading").show();let n=e.attr("data-index");vtexjs.checkout.getOrderForm().then((function(e){let t=[{index:parseInt(n),quantity:0}];return vtexjs.checkout.removeItems(t)})).done((function(e){t.bringInfo(),i.buildSummary(e.totalizers,e.value),$(".cart-loading").hide()}))}))},addQtd:function(e){e.find(".cart__table--qtd .btn-qtd.plus").on("click",(function(){let t=e.closest("tr").attr("data-index"),i=e.find('input[name="qtd"]'),a=parseInt(i.val());a++,i.val(a),n.updateQtd(e,t,a,i)}))},removeQtd:function(e){e.find(".cart__table--qtd .btn-qtd.minus").on("click",(function(){let t=e.closest("tr").attr("data-index"),i=e.find('input[name="qtd"]'),a=parseInt(i.val());a--,0!==a?(i.val(a),n.updateQtd(e,t,a,i)):e.find(".cart__table--remove").trigger("click")}))},changeQtd:function(e){const t=e.find('.cart__table--qtd input[name="qtd"]');t.on("change",(function(){$(".cart-loading").show();let i=e.closest("tr").attr("data-index");var a=parseInt($(this).val());n.updateQtd(e,i,a,t)}))},updateQtd:function(t,n,a,o){clearTimeout(window.productUpdate[n]),window.productUpdate[n]=setTimeout((function(){let r=e.verifyLimit(t.closest("tr").attr("data-productid"));a>r&&(a=r),vtexjs.checkout.getOrderForm().then((function(e){let t=[{index:parseInt(n),quantity:a}];return vtexjs.checkout.updateItems(t,null,!1)})).done((function(e){o.val(a),i.buildSummary(e.totalizers,e.value),$(".cart-loading").hide()}))}),300)},changeDelivery:function(t,n,i){setTimeout((function(){$('input[name="select-sla-'+i+'"]').on("change",(function(){"pickup-in-point"===$(this).closest("li").attr("data-info")?($(".cart-loading").show(),e.changeToPickup(i,t[0].pickupPointId)):($(".cart-loading").show(),e.changeToDelivery(i,n[0].id))}))}),1e3)},openModal:function(t,i,a){const o=$("#modal-opcoes"),r=$(".mais-opcoes__header--close"),s=$(".mask-modal"),d=$(".mais-opcoes__header--title"),c=$(".mais-opcoes__product--title"),l=$(".mais-opcoes__product--ref"),p=$(".mais-opcoes__listagem ul");setTimeout((function(){r.on("click",(function(){o.removeClass("active"),s.hide()})),$("#pickup-in-point_"+a).on("click",(function(){d.text("Lojas disponíveis para retirada"),c.text(i.name),l.find("span").text(i.refid),o.addClass("active"),s.show(),n.changeDeliveryFromModal();const a=t.filter((function(e){if("pickup-in-point"===e.deliveryChannel)return e}));p.html(""),a.map((function(t){p.append(`\n            <li>\n              <div class="mais-opcoes__listagem--item">\n                <i class="fa fa-box-open"></i>\n                <div class="info">\n                  <h5>${e.formatStoreName(t.pickupStoreInfo.address.addressId)}</h5>\n                  <p>${t.pickupStoreInfo.address.street} - nº ${t.pickupStoreInfo.address.number} - ${t.pickupStoreInfo.address.neighborhood}, ${t.pickupStoreInfo.address.city} - ${t.pickupStoreInfo.address.state}</p>\n\n                  <div class="estimate">\n                    <p>\n                      <strong>Frete</strong>\n                      ${0===t.price?"Grátis":e.formatReal(t.price)}\n                    </p>\n\n                    <p>\n                      <strong>Prazo</strong>\n                      ${e.formatEstimate(t.shippingEstimate)} após o pagamento\n                    </p>\n                  </div>\n                </div>\n              </div>\n              <button data-type="${t.deliveryChannel}" data-index="${i.index}" data-id="${t.pickupPointId}">Retirar na loja</button>\n            </li>\n            `)}))})),$("#delivery_"+a).on("click",(function(){d.text("Lojas disponíveis para entrega"),c.text(i.name),l.find("span").text(i.refid),o.addClass("active"),s.show(),n.changeDeliveryFromModal();const a=t.filter((function(e){if("delivery"===e.deliveryChannel)return e}));p.html(""),a.map((function(t){p.append(`\n            <li>\n              <div class="mais-opcoes__listagem--item">\n                <i class="fa fa-truck"></i>\n                <div class="info">\n                  <h5>${t.deliveryIds[0].courierName} - ${t.id}</h5>\n                  <div class="estimate">\n                    <p>\n                      <strong>Frete</strong>\n                      ${0===t.price?"Grátis":e.formatReal(t.price)}\n                    </p>\n\n                    <p>\n                      <strong>Prazo</strong>\n                      ${e.formatEstimate(t.shippingEstimate)} após o pagamento\n                    </p>\n                  </div>\n                </div>\n              </div>\n              <button data-type="${t.deliveryChannel}" data-index="${i.index}" data-id="${t.id}">Receber em casa</button>\n            </li>\n            `)}))}))}),1e3)},changeDeliveryFromModal:function(){setTimeout((function(){$(".mais-opcoes__listagem ul li").each((function(){$(this).find("button").on("click",(function(){const t=$(this).attr("data-type"),n=$(this).attr("data-index"),i=$(this).attr("data-id");"pickup-in-point"===t?($(".cart-loading").show(),e.changeToPickup(n,i)):($(".cart-loading").show(),e.changeToDelivery(n,i))}))}))}),1e3)},closeOrder:function(){$(".cart__summary--close-order").on("click",(function(){location.href="/checkout/#/email"}))}},i={init:function(){i.bringInfos(),i.sendCodeSeller(),i.sendCoupon(),i.changeCEP()},bringInfos:function(){vtexjs.checkout.getOrderForm().done((function(e){const t=e.shippingData.address.postalCode;i.bringCEP(t);const n=e.totalizers,a=e.value;i.buildSummary(n,a)}))},sendCodeSeller:function(){const e=localStorage.getItem("codeSeller"),t=$('.cart__summary--seller-code input[name="seller-code"]');vtexjs.checkout.getOrderForm().then((function(e){if(e.marketingData){if(""!==e.marketingData.utmiCampaign){let t=e.marketingData.utmiCampaign;return localStorage.setItem("codeSeller",t),vtexjs.checkout.sendAttachment("openTextField",{value:t})}return localStorage.removeItem("codeSeller",code),vtexjs.checkout.sendAttachment("openTextField",{value:""})}})),e&&t.val(e)},sendCoupon:function(){const e=localStorage.getItem("cupom"),t=$('.cart__summary--coupon input[name="discount-coupon"]'),n=$('.cart__summary--coupon input[name="discount-coupon-ok"]'),a=$('.cart__summary--coupon input[name="discount-coupon-remove"]');let o;e?(n.hide(),a.show(),t.val(e)):a.hide(),t.on("change",(function(){o=$(this).val()})),n.on("click",(function(){if($(".cart-loading").show(),void 0===o)return alert("Insira um cupom de desconto!"),void $(".cart-loading").hide();vtexjs.checkout.getOrderForm().then((function(){let e=o;return vtexjs.checkout.addDiscountCoupon(e)})).then((function(e){n.hide(),a.show(),t.val(o),localStorage.setItem("cupom",o),i.buildSummary(e.totalizers,e.value),$(".cart-loading").hide()}))})),a.on("click",(function(){$(".cart-loading").show(),vtexjs.checkout.getOrderForm().then((function(){return vtexjs.checkout.removeDiscountCoupon()})).then((function(e){n.show(),a.hide(),t.val(""),localStorage.removeItem("cupom"),i.buildSummary(e.totalizers,e.value),$(".cart-loading").hide()}))}))},bringCEP:function(e){const t=$(".cart__summary--frete-fixo .destaque"),n=$('.cart__summary--frete--box input[name="frete"]');t.text(e),n.val(e)},changeCEP:function(){const t=$(".cart__summary--frete-alterar"),n=$(".calcular-cep"),i=$(".info-cep"),a=$('.cart__summary--frete--box input[name="frete"]'),o=$('.cart__summary--frete--box input[name="frete-ok"]');t.on("click",(function(){i.hide(),a.val(""),n.show()})),o.on("click",(function(){if($(".cart-loading").show(),""!==a.val()){let t=a.val().replace(/\D/g,"");/^[0-9]{8}$/.test(t)?$.getJSON("https://viacep.com.br/ws/"+t+"/json/?callback=?",(function(n){if(!n.erro)return vtexjs.checkout.getOrderForm().then((n=>{let i=e.getMainLogistic(n);return vtexjs.checkout.sendAttachment("shippingData",{address:{country:"BRA",postalCode:t,addressType:"residential"},logisticsInfo:i}).done((e=>{location.reload()}))}));alert("Insira um CEP válido!"),$(".cart-loading").hide()})):(alert("Insira um CEP válido!"),$(".cart-loading").hide())}else alert("Preencha com um CEP válido!"),$(".cart-loading").hide()}))},buildSummary:function(t,n){const i=$(".cart__summary--subtotal table");i.html(""),t.map((function(t){let n;n="Items"===t.id?"Subtotal":"Discounts"===t.id?"Desconto":"Shipping"===t.id?"Frete":"",i.append(`\n        <tr data-info="${t.id}">\n          <td>${n}</td>\n          <td class="valor">${0!==t.value?e.formatReal(t.value):"Grátis"}</td>\n        </tr>\n        `)})),i.append(`\n      <tr data-info="total">\n        <td>Total</td>\n        <td class="valor">${e.formatReal(n)}</td>\n      </tr>\n      `)}};$(document).ready((function(){$('.cart__summary--frete--box input[name="frete"]').mask("99999-999"),i.init()}))}();