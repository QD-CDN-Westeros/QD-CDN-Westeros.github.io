!function(){const t={formatReal:function(t){return null===t?"":(0!=t&&(t/=100),t.toLocaleString("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).replace(".",","))},formatEstimate:function(t,e){return t.indexOf("bd")>0&&t.indexOf("1bd")<0?t.replace("bd"," dias"):0===t.indexOf("1bd")?t.replace("bd"," dia"):t.indexOf("h")>0?t.replace("h"," horas"):0===t.indexOf("0")?0!==e.length?"disponível somente para retirada":"indisponível":void 0},formatStoreName:function(t){if(t.indexOf("-")>0)return t.replace(/[^a-zA-Z0-9\.]+/g," ")},changeLocalStorage:function(t){localStorage.setItem("activeDeliveryChannel",t),localStorage.setItem("aditionalShippingData",JSON.stringify({activeTab:t,isScheduledDeliveryActive:!0,originComponent:"omnishipping",selectedLeanShippingOption:"CHEAPEST"}))},getMainLogistic:function(t,e){try{return t.shippingData.logisticsInfo.map((({itemIndex:t,slas:n})=>{const a=n.find((t=>t.pickupPointId==(e||null))),i=e?"pickup-in-point":"delivery";return{itemIndex:t,selectedSla:a.id,selectedDeliveryChannel:i}}))}catch{return null}},getLogisticSpecific:function(e,n,a){try{return e.shippingData.logisticsInfo.map((({itemIndex:e,slas:i})=>{const o=i.find((t=>t.id==a)),r=a?"delivery":"pickup-in-point";if(o)return t.showFlag(parseInt(n),e),{itemIndex:e,selectedSla:o.id,selectedDeliveryChannel:r}}))}catch{return null}},changeToPickup:function(e,n){let a=vtexjs.checkout.orderForm.shippingData.address.postalCode;vtexjs.checkout.sendAttachment("shippingData",{address:{country:"BRA",postalCode:a,addressType:"residential"}}).done((function(i){const o=i.shippingData.logisticsInfo.map((({itemIndex:a,slas:i})=>{const o=i.find((t=>t.pickupPointId==n));if(o)return t.showFlag(parseInt(e),a),{itemIndex:a,addressId:(-1*(new Date).getTime()).toString(),selectedSla:o.id,selectedDeliveryChannel:"pickup-in-point"}})).filter((function(t){if(void 0!==t)return t}));vtexjs.checkout.sendAttachment("shippingData",{address:{country:"BRA",postalCode:a,addressType:""},logisticsInfo:o},null).done((function(){t.changeLocalStorage("pickup-in-point"),$(".cart-loading").hide(),t.showAlert()}))}))},changeToDelivery:function(e,n){return vtexjs.checkout.getOrderForm().then((a=>{const i=t.getLogisticSpecific(a,parseInt(e),n).filter((function(t){if(void 0!==t)return t}));vtexjs.checkout.sendAttachment("shippingData",{address:{country:"BRA",postalCode:vtexjs.checkout.orderForm.shippingData.address.postalCode,addressType:"residential"},logisticsInfo:i},null).done((function(){t.changeLocalStorage("delivery"),$(".cart-loading").hide(),t.showAlert()}))}))},showAlert:function(){$("body").append('\n      <div class="alert-delivery">\n        <p><strong>Importante: </strong>O tipo de entrega de alguns produtos foi alterado. Verifique o seu carrinho.</p>\n        <button>ok</button>\n      </div>\n      '),$(".mask-modal").show(),$(".alert-delivery button").on("click",(function(){$(".alert-delivery").remove(),location.reload()}))},verifyLimit:function(t){let e=$.ajax({url:"/api/catalog_system/pub/products/search?fq=productId:"+t,method:"GET",async:!1});return JSON.parse(e.responseText)[0].items[0].sellers[0].commertialOffer.AvailableQuantity},showFlag:function(e,n){$("body").append('<div class="display-flag" data-flag="'+n+'"></div>');const a=t.buildArray($(".display-flag").toArray()).filter((function(t){if(t.index!==e)return t}));localStorage.setItem("alterados",JSON.stringify(a))},buildArray:function(t){for(var e=[],n=0;n<t.length;n++)e.push({index:parseInt(t[n].dataset.flag)});return e}},e={init:function(){e.bringInfo()},bringInfo:function(){vtexjs.checkout.getOrderForm().done((function(t){const n=vtexjs.checkout.orderForm.items,a=vtexjs.checkout.orderForm.shippingData.logisticsInfo,i=$(".cart-loading"),o=$(".cart"),r=$(".cart-empty");n.length>0?(e.buildCart(n,a),o.addClass("display-cart"),r.removeClass("display-empty-cart"),i.hide()):(o.removeClass("display-cart"),r.addClass("display-empty-cart"),i.hide())}))},buildCart:function(t,a){let i,o,r=[];t.map((function(t,e){const n=a.filter((function(t){if(t.itemIndex===e)return t}));n[0].slas.length>0?(i=n[0].slas.filter((function(t){if("pickup-in-point"===t.deliveryChannel)return t})),o=n[0].slas.filter((function(t){if("delivery"===t.deliveryChannel)return t}))):(i=[],o=[]);const s=n[0].slas.filter((function(t){if(t.id===n[0].selectedSla)return t}));let d;d=s.length>0?s[0].shippingEstimate:"0",r.push({index:n[0].itemIndex,productID:t.productId,skuid:t.id,refid:t.productRefId,name:t.name,link:t.detailUrl,image:t.imageUrl,price:t.price,qtd:t.quantity,hasPickup:i.length,hasDelivery:o.length,selectedDelivery:n[0].selectedDeliveryChannel,selectedSla:n[0].selectedSla,slas:n[0].slas,estimate:d,measure:t.measurementUnit,unit:t.unitMultiplier})})),e.addHTML(r),n.init()},addHTML:function(n){const a=$(".mz-cart .cart__table table");a.html(""),a.append("\n        <tr>\n          <th>Produto</th>\n          <th>Entrega</th>\n          <th>Qtd.</th>\n          <th>Valor</th>\n          <th></th>\n        </tr>\n      "),n.map((function(n,i){a.append(`\n        <tr data-index="${i}" data-productid="${n.productID}">\n          <td>\n            <div class="cart__table--flag hide-flag">entrega alterada</div>\n            <div class="cart__table--name">\n              <a href="${n.link}" target="_top"><img src="${n.image}" /></a>\n              <h2><a href="${n.link}" target="_top">${n.name}</a></h2>\n            </div>\n          </td>\n          <td>\n            <p>${t.formatEstimate(n.estimate,n.slas)}</p>\n          </td>\n          <td>\n            <div class="cart__table--qtd">\n              <span class="btn-qtd minus">-</span>\n              <input type="text" name="qtd" value="${n.qtd}" />\n              <span class="btn-qtd plus">+</span>\n            </div>\n            ${e.returnMeasure(n)}\n          </td>\n          <td>\n            <p><strong>${t.formatReal(n.price)}</strong></p>\n          </td>\n          <td>\n            <button data-index="${i}" class="cart__table--remove"></button>\n          </td>\n        </tr>\n        <tr data-index="${i}" class="cart__table--entrega ${"0"===n.estimate&&0===n.slas.length?"indisponivel":""}">\n          <td colspan="5">\n            <h4>Opções de entrega</h4>\n            <div class="cart__table--entrega--options">\n              <ul>\n                ${e.returnLogistInfo(n)}\n              </ul>\n            </div>\n          </td>\n        </tr>\n        `)}))},returnMeasure:function(t){return"un"!==t.measure?`\n        <div class="cart__table--medida" data-unit="${t.unit}">\n          <p>${parseFloat((t.unit*t.qtd).toFixed(2))+" "+t.measure}</p>\n        </div>\n        `:""},returnLogistInfo:function(e){let a=[];if(0!==e.hasPickup&&0!==e.hasDelivery?a.push({id:"delivery"},{id:"pickup-in-point"}):0!==e.hasPickup&&0===e.hasDelivery?a.push({id:"pickup-in-point"}):a.push({id:"delivery"}),e.slas.length>0){const o=e.slas.filter((function(t){if("pickup-in-point"===t.deliveryChannel)return t})),r=e.slas.filter((function(t){if("delivery"===t.deliveryChannel)return t})),s=e.slas.filter((function(t){if(t.id===e.selectedSla)return t}));return n.changeDelivery(o,r,e.index),1===e.slas.length&&"pickup-in-point"===e.slas[0].deliveryChannel?`\n            <li data-info="pickup-in-point">\n              <label>\n                <input type="radio" name="select-sla-${e.index}" data-itemid="${e.productID}" data-itemindex="${e.index}" ${"pickup-in-point"===e.selectedDelivery?'checked="checked"':""} />\n                <span class="checkmark"></span>\n              </label>\n              <div class="description">\n                <p><strong>Retirar na loja</strong></p>\n                <p class="prazo"><strong>Prazo: </strong>${t.formatEstimate(e.estimate,e.slas)} após o pagamento</p>\n                ${i("pickup-in-point")}\n              </div>\n            </li>\n            `:a.map((function(n){let a,d;return a="delivery"===n.id?"Receber em casa":"Retirar na loja",d="delivery"===n.id?"pickup-in-point"!==s[0].deliveryChannel?s[0].shippingEstimate:r[0].shippingEstimate:s.length>0?"delivery"!==s[0].deliveryChannel?s[0].shippingEstimate:o[0].shippingEstimate:"0",`\n          <li data-info="${n.id}">\n            <label>\n              <input type="radio" name="select-sla-${e.index}" data-itemid="${e.productID}" data-itemindex="${e.index}" ${e.selectedDelivery===n.id?'checked="checked"':""} />\n              <span class="checkmark"></span>\n            </label>\n            <div class="description">\n              <p><strong>${a}</strong></p>\n              <p class="prazo"><strong>Prazo: </strong>${t.formatEstimate(d,e.slas)} após o pagamento</p>\n              ${i(n.id)}\n            </div>\n          </li>\n          `})).join("");function i(a){if(n.openModal(e.slas,e,e.index),"pickup-in-point"===a){if(o.length>1){let n,a,i,r,d,c;return s.length>0&&"pickup-in-point"===s[0].deliveryChannel?(n=s[0].pickupStoreInfo.address.addressId,a=s[0].pickupStoreInfo.address.street,i=s[0].pickupStoreInfo.address.number,r=s[0].pickupStoreInfo.address.neighborhood,d=s[0].pickupStoreInfo.address.city,c=s[0].pickupStoreInfo.address.state):(n=o[0].pickupStoreInfo.address.addressId,a=o[0].pickupStoreInfo.address.street,i=o[0].pickupStoreInfo.address.number,r=o[0].pickupStoreInfo.address.neighborhood,d=o[0].pickupStoreInfo.address.city,c=o[0].pickupStoreInfo.address.state),`\n              <div class="local">\n                <p><strong>${t.formatStoreName(n)}</strong></p>\n                <p>${a} - nº ${i} - ${r}, ${d} - ${c}</p>\n              </div>\n              <div class="more">\n                <a id="pickup-in-point_${e.index}">Ver outras opções de retirada</a>\n              </div>\n              `}return`\n              <div class="local">\n                <p><strong>${t.formatStoreName(o[0].pickupStoreInfo.address.addressId)}</strong></p>\n                <p>${o[0].pickupStoreInfo.address.street} - nº ${o[0].pickupStoreInfo.address.number} - ${o[0].pickupStoreInfo.address.neighborhood}, ${o[0].pickupStoreInfo.address.city} - ${o[0].pickupStoreInfo.address.state}</p>\n              </div>\n              `}return r.length>1?`\n              <div class="more">\n                <a id="delivery_${e.index}">Ver outras opções de entrega</a>\n              </div>\n              `:""}}return'\n        <li data-info="indisponivel">\n          <i class="fa fa-exclamation-triangle"></i>\n          <span>Este produto não está disponível para esse endereço</span>\n        </li>\n        '}};$(document).ready((function(){e.init()}));const n={init:function(){n.cart(),n.productTimeout(),n.closeOrder(),n.applyFlag()},productTimeout:function(){window.productUpdate={}},cart:function(){$(".cart__table table tr:not(.cart__table--entrega)").each((function(){n.removeItem($(this)),n.addQtd($(this)),n.removeQtd($(this)),n.changeQtd($(this))}))},removeItem:function(t){t.find(".cart__table--remove").on("click",(function(){localStorage.removeItem("alterados"),$(".cart-loading").show();let n=t.attr("data-index");vtexjs.checkout.getOrderForm().then((function(t){let e=[{index:parseInt(n),quantity:0}];return vtexjs.checkout.removeItems(e)})).done((function(t){e.bringInfo(),a.buildSummary(t.totalizers,t.value),$(".cart-loading").hide()}))}))},addQtd:function(t){t.find(".cart__table--qtd .btn-qtd.plus").on("click",(function(){let e=t.closest("tr").find(".cart__table--medida").attr("data-unit"),a=t.closest("tr").find(".cart__table--medida p"),i=t.closest("tr").attr("data-index"),o=t.find('input[name="qtd"]'),r=parseInt(o.val());r++,e&&a.text(parseFloat(Number(e)*r).toFixed(2)+" m²"),o.val(r),n.updateQtd(t,i,r,o)}))},removeQtd:function(t){t.find(".cart__table--qtd .btn-qtd.minus").on("click",(function(){let e=t.closest("tr").find(".cart__table--medida").attr("data-unit"),a=t.closest("tr").find(".cart__table--medida p"),i=t.closest("tr").attr("data-index"),o=t.find('input[name="qtd"]'),r=parseInt(o.val());r--,0!==r?(e&&a.text(parseFloat(Number(e)*r).toFixed(2)+" m²"),o.val(r),n.updateQtd(t,i,r,o)):t.find(".cart__table--remove").trigger("click")}))},changeQtd:function(t){const e=t.find('.cart__table--qtd input[name="qtd"]');e.on("change",(function(){$(".cart-loading").show();let a=t.closest("tr").find(".cart__table--medida").attr("data-unit"),i=t.closest("tr").find(".cart__table--medida p"),o=t.closest("tr").attr("data-index");var r=parseInt($(this).val());a&&i.text(parseFloat(Number(a)*r).toFixed(2)+" m²"),n.updateQtd(t,o,r,e)}))},updateQtd:function(e,n,i,o){clearTimeout(window.productUpdate[n]),window.productUpdate[n]=setTimeout((function(){let r=t.verifyLimit(e.closest("tr").attr("data-productid"));i>r&&(i=r),vtexjs.checkout.getOrderForm().then((function(t){let e=[{index:parseInt(n),quantity:i}];return vtexjs.checkout.updateItems(e,null,!1)})).done((function(t){o.val(i),a.buildSummary(t.totalizers,t.value),$(".cart-loading").hide()}))}),1e3)},changeDelivery:function(e,n,a){setTimeout((function(){$('input[name="select-sla-'+a+'"]').on("change",(function(){localStorage.removeItem("alterados"),"pickup-in-point"===$(this).closest("li").attr("data-info")?($(".cart-loading").show(),t.changeToPickup(a,e[0].pickupPointId)):($(".cart-loading").show(),t.changeToDelivery(a,n[0].id))}))}),1e3)},openModal:function(e,a,i){const o=$("#modal-opcoes"),r=$(".mais-opcoes__header--close"),s=$(".mask-modal"),d=$(".mais-opcoes__header--title"),c=$(".mais-opcoes__product--title"),l=$(".mais-opcoes__product--ref"),p=$(".mais-opcoes__listagem ul");setTimeout((function(){r.on("click",(function(){o.removeClass("active"),s.hide()})),$("#pickup-in-point_"+i).on("click",(function(){d.text("Lojas disponíveis para retirada"),c.text(a.name),l.find("span").text(a.refid),o.addClass("active"),s.show(),n.changeDeliveryFromModal();const i=e.filter((function(t){if("pickup-in-point"===t.deliveryChannel)return t}));p.html(""),i.map((function(e){p.append(`\n            <li>\n              <div class="mais-opcoes__listagem--item">\n                <i class="fa fa-box-open"></i>\n                <div class="info">\n                  <h5>${t.formatStoreName(e.pickupStoreInfo.address.addressId)}</h5>\n                  <p>${e.pickupStoreInfo.address.street} - nº ${e.pickupStoreInfo.address.number} - ${e.pickupStoreInfo.address.neighborhood}, ${e.pickupStoreInfo.address.city} - ${e.pickupStoreInfo.address.state}</p>\n\n                  <div class="estimate">\n                    <p>\n                      <strong>Frete</strong>\n                      ${0===e.price?"Grátis":t.formatReal(e.price)}\n                    </p>\n\n                    <p>\n                      <strong>Prazo</strong>\n                      ${t.formatEstimate(e.shippingEstimate)} após o pagamento\n                    </p>\n                  </div>\n                </div>\n              </div>\n              <button data-type="${e.deliveryChannel}" data-index="${a.index}" data-id="${e.pickupPointId}">Retirar na loja</button>\n            </li>\n            `)}))})),$("#delivery_"+i).on("click",(function(){d.text("Lojas disponíveis para entrega"),c.text(a.name),l.find("span").text(a.refid),o.addClass("active"),s.show(),n.changeDeliveryFromModal();const i=e.filter((function(t){if("delivery"===t.deliveryChannel)return t}));p.html(""),i.map((function(e){p.append(`\n            <li>\n              <div class="mais-opcoes__listagem--item">\n                <i class="fa fa-truck"></i>\n                <div class="info">\n                  <h5>${e.deliveryIds[0].courierName} - ${e.id}</h5>\n                  <div class="estimate">\n                    <p>\n                      <strong>Frete</strong>\n                      ${0===e.price?"Grátis":t.formatReal(e.price)}\n                    </p>\n\n                    <p>\n                      <strong>Prazo</strong>\n                      ${t.formatEstimate(e.shippingEstimate)} após o pagamento\n                    </p>\n                  </div>\n                </div>\n              </div>\n              <button data-type="${e.deliveryChannel}" data-index="${a.index}" data-id="${e.id}">Receber em casa</button>\n            </li>\n            `)}))}))}),1e3)},changeDeliveryFromModal:function(){setTimeout((function(){$(".mais-opcoes__listagem ul li").each((function(){$(this).find("button").on("click",(function(){localStorage.removeItem("alterados");const e=$(this).attr("data-type"),n=$(this).attr("data-index"),a=$(this).attr("data-id");"pickup-in-point"===e?($(".cart-loading").show(),t.changeToPickup(n,a)):($(".cart-loading").show(),t.changeToDelivery(n,a))}))}))}),1e3)},closeOrder:function(){$(".cart__final--close-order").on("click",(function(){window.parent.location.href="/checkout/#/email",parent.location.reload()}))},applyFlag:function(){let t=JSON.parse(localStorage.getItem("alterados"));$(".cart__table table tr:not(.cart__table--entrega)").each((function(){let e=$(this).attr("data-index"),n=$(this);t&&t.map((function(t){t.index==parseInt(e)&&n.find(".cart__table--flag").removeClass("hide-flag")}))}))}},a={init:function(){a.bringInfos(),a.sendCodeSeller(),a.sendCoupon(),a.changeCEP()},bringInfos:function(){vtexjs.checkout.getOrderForm().done((function(t){const e=t.shippingData.address.postalCode;a.bringCEP(e);const n=t.totalizers,i=t.value;a.buildSummary(n,i)}))},sendCodeSeller:function(){const t=localStorage.getItem("codeSeller"),e=$('.cart__summary--seller-code input[name="seller-code"]');vtexjs.checkout.getOrderForm().then((function(t){if(t.marketingData){if(""!==t.marketingData.utmiCampaign){let e=t.marketingData.utmiCampaign;return localStorage.setItem("codeSeller",e),vtexjs.checkout.sendAttachment("openTextField",{value:e})}return localStorage.removeItem("codeSeller",code),vtexjs.checkout.sendAttachment("openTextField",{value:""})}})),t&&"null"!==t?e.val(t):e.val("")},sendCoupon:function(){const t=localStorage.getItem("cupom"),e=$('.cart__summary--coupon input[name="discount-coupon"]'),n=$('.cart__summary--coupon input[name="discount-coupon-ok"]'),i=$('.cart__summary--coupon input[name="discount-coupon-remove"]');let o;t?(n.hide(),i.show(),e.val(t)):i.hide(),e.on("change",(function(){o=$(this).val()})),n.on("click",(function(){if($(".cart-loading").show(),void 0===o)return alert("Insira um cupom de desconto!"),void $(".cart-loading").hide();vtexjs.checkout.getOrderForm().then((function(){let t=o;return vtexjs.checkout.addDiscountCoupon(t)})).then((function(t){n.hide(),i.show(),e.val(o),localStorage.setItem("cupom",o),a.buildSummary(t.totalizers,t.value),$(".cart-loading").hide()}))})),i.on("click",(function(){$(".cart-loading").show(),vtexjs.checkout.getOrderForm().then((function(){return vtexjs.checkout.removeDiscountCoupon()})).then((function(t){n.show(),i.hide(),e.val(""),localStorage.removeItem("cupom"),a.buildSummary(t.totalizers,t.value),$(".cart-loading").hide()}))}))},bringCEP:function(t){const e=$(".cart__summary--frete-fixo .destaque"),n=$('.cart__summary--frete--box input[name="frete"]');e.text(t),n.val(t)},changeCEP:function(){const e=$(".cart__summary--frete-alterar"),n=$(".calcular-cep"),a=$(".info-cep"),i=$('.cart__summary--frete--box input[name="frete"]'),o=$('.cart__summary--frete--box input[name="frete-ok"]');e.on("click",(function(){a.hide(),i.val(""),n.show()})),o.on("click",(function(){if($(".cart-loading").show(),""!==i.val()){let e=i.val().replace(/\D/g,"");/^[0-9]{8}$/.test(e)?$.getJSON("https://viacep.com.br/ws/"+e+"/json/?callback=?",(function(n){if(!n.erro)return vtexjs.checkout.getOrderForm().then((n=>{let a=t.getMainLogistic(n);return vtexjs.checkout.sendAttachment("shippingData",{address:{country:"BRA",postalCode:e,addressType:"residential"},logisticsInfo:a}).done((t=>{location.reload()}))}));alert("Insira um CEP válido!"),$(".cart-loading").hide()})):(alert("Insira um CEP válido!"),$(".cart-loading").hide())}else alert("Preencha com um CEP válido!"),$(".cart-loading").hide()}))},buildSummary:function(e,n){const a=$(".cart__summary--subtotal table");a.html(""),e.map((function(e){let n;n="Items"===e.id?"Subtotal":"Discounts"===e.id?"Desconto":"Shipping"===e.id?"Frete":"",a.append(`\n        <tr data-info="${e.id}">\n          <td>${n}</td>\n          <td class="valor">${0!==e.value?t.formatReal(e.value):"Grátis"}</td>\n        </tr>\n        `)})),a.append(`\n      <tr data-info="total">\n        <td>Total</td>\n        <td class="valor">${t.formatReal(n)}</td>\n      </tr>\n      `)}};$(document).ready((function(){$('.cart__summary--frete--box input[name="frete"]').mask("99999-999"),a.init()}))}();