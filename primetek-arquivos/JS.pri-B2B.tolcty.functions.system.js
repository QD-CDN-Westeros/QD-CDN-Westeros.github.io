/* DESKTOP-US8NRQT - 15/09/2020 10:36:23 GMT */
var B2B={run:function(){},init:function(){B2B.applyRegisterFormModal();B2B.handlerReceiptForm();B2B.sendAccessForm();B2B.expandForm()},ajaxStop:function(){},windowOnload:function(){},applyRegisterFormModal:function(){$(".qd-v1-modal").addClass("qd-v1-modal-form-b2b").removeClass("fade").removeClass("qd-v1-modal");$("body .register-b2b").click(function(){$(document.body).addClass("modal-open");$(".QDb2bFormRegister").appendTo(".qd-v1-modal-form-b2b .modal-body");$(".QDb2bconfirmation").appendTo(".qd-v1-modal-form-b2b .modal-body");$(".qd-v1-modal-form-b2b").show();$(".QDb2bFormRegister").modal();$(".modal-backdrop").show();return false});$(".qd-v1-modal-form-b2b .close, .QDs__form--btnback").click(function(){$(".qd-v1-modal-form-b2b, .modal-backdrop").hide();$(document.body).removeClass("modal-open")})},expandForm:function(){var wrapper=$(".QDr__box-expand");wrapper.delegate("a","click",function(){$(this).removeAttr("href");$(this).next(".QDb").toggleClass("qd-active").siblings().children().removeClass("qd-active")})},formCadastreMask:function(){var form=$(".form-qd-v1");if(!form.length||typeof $.fn.mask!=="function")return;form.find("[name=businessPhone]").mask("(00) 0000-0000");form.find("[name=phone]").mask("(00) 00000-0000");form.find("[name=corporateDocument]").mask("00.000.000/0000-00");form.find("[name=stateRegistration]").mask("000.000.000.000.000.000");form.find("[name=fixedPhone]").mask("(00) 0000-0000");form.find("[name=cellPhone]").mask("(00) 0000-00009");form.find("[name=postalCode]").mask("00000-000");form.find("[name=birthDate]").mask("00/00/0000")},checkEmailExist:function(email){window.QD_checkEmailExist_request=window.QD_checkEmailExist_request||$.ajax({url:"/api/dataentities/CL/search",data:{_fields:"id",email:email},type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(data){if(data.length)alert("Este e-mail já existe em nosso cadastro. Para maiores informações por favor entre em contato com o Atendimento ao Cliente.")},complete:function(){window.QD_checkEmailExist_request=undefined}});return window.QD_checkEmailExist_request},checkCnpjExist:function(cnpj){window.QD_checkCnpjExist_request=window.QD_checkCnpjExist_request||$.ajax({url:"/api/dataentities/CL/search",data:{_fields:"id",corporateDocument:cnpj.replace(/[^0-9]/gi,"")},type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(data){if(data.length)alert("Este CNPJ já existe em nosso cadastro. Para maiores informações por favor entre em contato com o Atendimento ao Cliente.")},complete:function(){window.QD_checkCnpjExist_request=undefined}});return window.QD_checkCnpjExist_request},sendAccessForm:function(){B2B.formCadastreMask();var $form=$("#QDb2b-form");var loading=$("form-qd-v1-loading").hide();var email=$form.find("[name='email']");email.focusout(function(e){if((email.val()||"").length>0)B2B.checkEmailExist(email.val()||"")});if(typeof $.fn.validate!=="function")return;$form.validate({rules:{email:{email:true}},submitHandler:function(form){var $form=$(form);var idRegister="";if(!$form.valid())return;loading.slideDown();var inputs=$form.find("input, textarea");B2B.checkEmailExist(inputs.filter("[name='email']").val()||"").always(function(){loading.slideUp()}).done(function(data){if(data.length)return;loading.slideDown();var stateRegistration=(inputs.filter("[name='stateRegistration']").val()||"Isento").trim();stateRegistration=stateRegistration.length?stateRegistration:"Isento";stateRegistration=stateRegistration.replace(/i.+ento/g,"Isento");var stateRegistration2=(inputs.filter("[name='stateRegistration2']").val()||"Isento").trim();stateRegistration2=stateRegistration2.length?stateRegistration2:"Isento";stateRegistration2=stateRegistration2.replace(/i.+ento/g,"Isento");var countyRegistration=(inputs.filter("[name='qd_form_im']").val()||"Isento").trim();countyRegistration=countyRegistration.length?countyRegistration:"Isento";countyRegistration=countyRegistration.replace(/i.+ento/g,"Isento");var termosVal=$("#MZ-form-check").is(":checked");var termosVal2=$("#MZ-form-check-2").is(":checked");var hasCNPJ=false;if(inputs.filter("[name='corporateDocument']").val())hasCNPJ=true;$.ajax({type:"POST",url:"/api/dataentities/CL/documents",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify({firstName:inputs.filter("[name='firstName']").val()||"",lastName:inputs.filter("[name='lastName']").val()||"",businessPhone:"+55"+(inputs.filter("[name='businessPhone']").val()||"").replace(/[^0-9]/gi,""),birthDate:(inputs.filter("[name='birthDate']").val()||"").split("/").reverse().join("-"),gender:inputs.filter("[name='gender']").val()||"",phone:"+55"+(inputs.filter("[name='phone']").val()||"").replace(/[^0-9]/gi,""),email:inputs.filter("[name='email']").val()||"",isNewsletterOptIn:termosVal,isNewsletterOptInCell:termosVal2,stateRegistration:stateRegistration,countyRegistration:countyRegistration,isCorporate:true,localeDefault:"pt-BR",documentType:"cpf",hasCNPJ:hasCNPJ}),success:function(data){$.ajax({url:"/api/dataentities/AD/documents",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify({addressName:"Principal",userId:(data.Id||"").replace(/^[a-z]{2}\-/i,""),street:inputs.filter("[name='street']").val()||"",complement:inputs.filter("[name='complement']").val()||"",neighborhood:inputs.filter("[name='neighborhood']").val()||"",city:inputs.filter("[name='city']").val()||"",state:inputs.filter("[name='state']").val()||"",addressType:"residential",receiverName:inputs.filter("[name='firstName']").val()||"",country:"BRA",geoCoordinate:[]}),success:function(){$(".QDb2bconfirmation").show();$(".qd-v1-modal-form-b2b .QDb2bFormRegister.in").addClass("hide");$(".modal-backdrop").addClass("hide");$(document.body).removeClass("modal-open");$(document).scrollTop(0)},error:function(data){alert("Não foi possível enviar seu formulário, por favor tente novamente ou entre em contato por telefone.")},complete:function(){loading.slideUp(function(){$(this).remove()})}})},error:function(){alert("Não foi possível enviar seu formulário, por favor tente novamente ou entre em contato por telefone.");loading.slideUp(function(){$(this).remove()})}}).done(function(response){console.log("foi")})})},errorPlacement:function(error,element){}})},handlerReceiptForm:function(){var form=$(".QDs__m--form");B2B.onAttachFile(form)},onAttachFile:function(form){var wrapperFile=$('<span><i class="fa fa-times" aria-hidden="true"></i></span>');var inputedFiles=form.find(".inputedFiles");var btnAddAttach=form.find("a.attach-file");function handleAddButton(){if(!form.find("input[type=file]:not(.filled)").length)btnAddAttach.hide();else btnAddAttach.show()}form.find("input[type=file]").on("change",function(){if(!this.files.length)return;var newFile=wrapperFile.clone().attr("id",this.name).append(this.files[0].name).appendTo(inputedFiles);$(this).removeAttr("required").addClass("filled");handleAddButton();newFile.find("i").on("click",function(){var inputName=$(this).parent().attr("id");form.find("input[name="+inputName+"]").removeClass("filled").val("");$(this).parent().remove();if(!form.find("input[type=file].filled").length)form.find("input[type=file]").first().attr("required","");handleAddButton()})});btnAddAttach.on("click",function(e){e.preventDefault();form.find("input[type=file]:not(.filled)").first().click()})}};