/* eduardo - 23/07/2021 15:22:59 GMT */
$(function(){mostraLoader(".passo-um");loadFormularioLogin()});function loadFormularioLogin(){var form_login='<form action="javascript:enviaLogin();" method="post" class="form-login-lojista">'+'\t<div class="col-xs-12 text-center titulo-cadastro">Faça seu login</div>'+'\t<input type="text" id="email-lojista" placeholder="E-mail">'+'\t<input class="btn-entra-login-lojista" value="Entrar" type="submit" />'+'\t<div class="nao-sou-cadastrado">'+'\t\t<a class="load-formulario-cadastro" href="/cadastro-lojista">Não sou cadastrado</a>'+"\t</div>"+"</form>";$(".form-cadastro-lojista").html(form_login);$("a.load-formulario-cadastro").click(function(){loadFormulario();return false})}function loadFormulario(){var formulario='<div class="passo-um">'+'\t<div class="dados-um" style="text-align:center">'+'\t\t<div class="col-xs-12 titulo-cadastro">Dados cadastrais do cliente</div>'+'\t\t<div class="col-xs-12 text-right">*Campos obrigatórios</div>'+'       <input style="margin:5px" type="text" name="qd_name" placeholder="*Nome" />'+'\t\t<div class="col-xs-12">'+'\t\t\t<input style="margin:5px" type="text" name="qd_cpf" placeholder="*CPF"/>'+"\t\t</div>"+'\t\t<div class="col-xs-12">'+'\t\t\t<input style="margin:5px" type="text" name="qd_matricula" placeholder="*Matricula" />'+"\t\t</div>"+'\t\t<div class="col-xs-12">'+'\t\t\t<input style="margin:5px" type="text" name="qd_email" placeholder="*E-mail" />'+"\t\t</div>"+'\t\t<div class="col-xs-12"><div id="btn-dados-um" class="btn-salvar-lojista">Salvar</div></div>'+"\t</div>"+"</div>"+'<div class="passo-dois" style="display:none">'+'\t<div class="col-xs-12 text-center titulo-cadastro">Caro cliente, seu cadastro foi enviado com sucesso.</div>'+'\t<div class="col-xs-12 text-center">Dentro de 72 horas você será contatado para receber seu login e sua senha para compra.</div>'+"</div>";$(".form-cadastro-lojista").html(formulario);preparaBoxUm()}function preparaBoxUm(){$(".passo-um").fadeIn();$("#btn-dados-um").click(function(){console.log("clicando");var resultado=validaFormulario();if(resultado=="sucesso"){salvaPassoUm()}else{errorMessage(".passo-dois",resultado)}})}function validaFormulario(){var cpf=$('input[name="qd_cpf"]').val();var nome=$('input[name="qd_name"]').val();var matricula=$('input[name="qd_matricula"]').val();var email=$('input[name="qd_email"]').val();if(cpf==""){return alert("Informe o CPF")}if(nome==""){return alert("Informe o Contato")}if(matricula==""){return alert("Informe o Nº da Matricula")}if(email==""){return alert("Informe o E-mail")}if(!IsEmail(email)){return alert("Informe um E-mail válido")}return"sucesso"}function salvaPassoUm(){console.log("esta funcionando");var cpf=$('input[name="qd_cpf"]').val();var nome=$('input[name="qd_name"]').val();var matricula=$('input[name="qd_matricula"]').val();var email=$('input[name="qd_email"]').val();var dc_passo="um";var cl_json={qd_cpf:cpf,qd_name:nome,qd_matricula:matricula,email:email};var cl_url="/api/dataentities/CL/documents/";$.ajax({headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json"},data:JSON.stringify(cl_json),type:"PATCH",url:cl_url,success:function(data,textStatus,xhr){if(xhr.status=="200"||xhr.status=="201"){$("#id_dc-selecionado").val(data.Id);$(".passo-um").hide("slow");$(".passo-dois").show("slow")}else if(xhr.status=="304"){$("#id_dc-selecionado").val(data.Id);$(".passo-um").hide("slow");$(".passo-dois").show("slow")}else{console.log("Deu erro")}},error:function(data){console.log(data)}})}function mostraLoader(seletor){$(seletor).append('<div class="loader-msg" display="none;"><div class="div-gif"><img src="/arquivos/loader-gif.gif"></div></div>');$(".loader-msg").fadeIn()}function errorMessage(seletor,msg){$(seletor).append('<div class="error-msg" display="none;">'+msg+"</div>");$(".error-msg").fadeIn(3e3).fadeOut(3e3,function(){$(this).remove()})}function mascaraCep(o,f){v_obj=o;v_fun=f;setTimeout("execmascaraCep()",1)}function execmascaraCep(){v_obj.value=v_fun(v_obj.value)}function cep(v){v=v.replace(/\D/g,"");v=v.replace(/^(\d{5})(\d)/g,"$1-$2");return v}function mascaraTel(o,f){v_obj=o;v_fun=f;setTimeout("execmascaraTel()",1)}function execmascaraTel(){v_obj.value=v_fun(v_obj.value)}function tel(v){v=v.replace(/\D/g,"");v=v.replace(/^(\d{2})(\d)/g,"($1) $2");v=v.replace(/(\d)(\d{4})$/,"$1-$2");return v}function mascaraCnpj(o,f){v_obj=o;v_fun=f;setTimeout("execmascaraCnpj()",1)}function execmascaraCnpj(){v_obj.value=v_fun(v_obj.value)}function cnpj(v){v=v.replace(/\D/g,"");v=v.replace(/^(\d{2})(\d{3})?(\d{3})?(\d{4})?(\d{2})?/,"$1.$2.$3/$4-$5");return v}function id(el){return document.getElementById(el)}function setCookie(name,value,duration){var cookie=name+"="+escape(value)+(duration?"; duration="+duration.toGMTString():"");document.cookie=cookie}function getCookie(name){var cookies=document.cookie;var prefix=name+"=";var begin=cookies.indexOf("; "+prefix);if(begin==-1){begin=cookies.indexOf(prefix);if(begin!=0){return null}}else{begin+=2}var end=cookies.indexOf(";",begin);if(end==-1){end=cookies.length}return unescape(cookies.substring(begin+prefix.length,end))}function deleteCookie(name){if(getCookie(name)){document.cookie=name+"="+"; expires=Thu, 01-Jan-70 00:00:01 GMT"}}function getDuracao(dias){var duracao=new Date;duracao.setDate(duracao.getDate()+dias);return duracao}function IsEmail(email){var regex=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return regex.test(email)}function enviaLogin(){var resultado=validaFormularioLogin();if(resultado=="sucesso"){var email=$("#email-lojista").val();loginLojista(email)}else{errorMessageLogin(".form-login-lojista",resultado)}}function errorMessageLogin(seletor,msg){$(seletor).append('<div class="error-msg" display="none;">'+msg+"</div>");$(".error-msg").fadeIn(3e3).fadeOut(3e3,function(){$(this).remove()})}function mostraLoaderLogin(seletor){$(seletor).append('<div class="loader-msg" display="none;"><div class="div-gif"><img src="/arquivos/loader-gif.gif"></div></div>');$(".loader-msg").fadeIn()}function removeLoaderLogin(seletor){$(".loader-msg").fadeOut(1e3,function(){$(this).remove()})}function validaFormularioLogin(){var email=$("#email-lojista").val();if(email==""){email.addClass("error");return"Informe o E-mail"}if(!IsEmail(email)){email.addClass("error");return"Informe um E-mail vÃ¡lido"}return"sucesso"}function IsEmailLogin(email){var regex=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return regex.test(email)}function loginLojista(email){mostraLoaderLogin(".form-login-lojista");var url="/api/dataentities/CL/search/?email="+email+"&_fields=approved";$.ajax({headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json"},type:"GET",url:url,success:function(data,textStatus,xhr){if(xhr.status=="200"||xhr.status=="201"){return loadLojista(data)}else{console.log(data)}},error:function(data){console.log(data);removeLoaderLogin(".form-login-lojista")}})}function loadLojista(data){removeLoaderLogin(".form-login-lojista");console.log(data[0].approved);if(data[0]!=null){if(data[0].approved){var email=$("#email-lojista").val();$("body,html").animate({scrollTop:0},"slow");vtexid.start({returnUrl:"/",userEmail:email,locale:"pt-BR",forceReload:true,scopeName:"herbariumb2b"})}else{errorMessageLogin(".form-login-lojista","Seu cadastro ainda nÃ£o foi aprovado.")}}else{errorMessageLogin(".form-login-lojista","E-mail ou Senha estÃ£o incorretos.")}}