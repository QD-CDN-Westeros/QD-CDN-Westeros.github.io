$(function(){if($(document.body).is(".product-kit"))return;if(vtxctx.departmentName=="Personalizados")$(document.body).addClass("qd-fpp-product-page");var e=$('<a href="#" class="qd-fpp-btn">Personalizar</a>').click(a);$(".product-qd-v1-sku-selection-box .product-qd-v1-buy-button").prepend(e);$(".qd-fpp-banner").click(a);var b=$('<div class="qd-fpp-pre-load" style="width:1px;height:1px;overflow:hidden;opacity:0.01;"><br /></div>').insertAfter(e);var x=null;var s=null;if(skuJson.skus.length>1)$(window).on("skuSelected.vtex",function(e,a,i){x=i.sku;s=i.sellerId});else{x=skuJson.skus[0].sku;s=skuJson.skus[0].sellerId}function d(t,e){t.addClass("qd-loading");$.qdAjax({url:"/produto/sku/"+e}).done(function(e){var a=e[0].Images;var i;for(var s=0;s<a.length;s++)if(a[s][0].name=="Personaliza")i=a[s][0].Path;if(!i)i=a[0][0].Path;t.prepend('<img class="sku-image" src="'+i.replace(/(ids\/\d+)-\d+-\d+/,"$1-350-350")+'" />');t.removeClass("qd-loading")})}function o(g){g.find(".qd-fpp-items").addClass("qd-loading");vtexjs.checkout.simulateShipping([{id:x,quantity:1,seller:s}],"","BRA").done(function(e){var a=e.items;var i=null;for(var s=0;s<a.length;s++){if(a[s].id==x){i=s;continue}}if(i==null)return;var t;var d;var o=[];var l,n,r,p,f;for(var c=0;c<a[i].offerings.length;c++){t=a[i].offerings[c].attachmentOfferings;d=a[i].offerings[c].id;for(var s=0;s<t.length;s++){if(!(t[s].schema&&t[s].schema["Autoriza abrir embalagem"]))continue;f=t[s].schema["Autoriza abrir embalagem"];l=t[s].schema["Texto"]||null;text2=t[s].schema["Texto 2"]||null;n=t[s].schema["Letra"]?t[s].schema["Letra"].domain:null;r=t[s].schema["Figura"]?t[s].schema["Figura"].domain:null;p=t[s].schema["Cor da letra"]?t[s].schema["Cor da letra"].domain:null;if(l||text2||n||r||p)o.push({name:t[s].name,offering:a[i].offerings[c],fields:{authorizeOpenPackage:f,text:l,text2:text2,fonts:n,illustrations:r,colors:p}})}}if(!o.length){g.find(".qd-fpp-items").html('<p class="qd-error"> Serviço de personalização de SKU não encontrado.</p>');g.find(".qd-fpp-items").removeClass("qd-loading");return}var u=o[0];var m=a[i].sellingPrice+u.offering.price;g.find(".qd-fpp-price .total-price").text("R$ "+qd_number_format(m/100,2,",","."));if(u.fields.authorizeOpenPackage!=null)g.find(".qd-authorize-remove-product").closest("fieldset").show();if(u.fields.text!=null)g.find(".qd-baby-name").closest("fieldset").show();if(u.fields.text2!=null)g.find(".qd-baby-name-second").closest("fieldset").show();if(u.fields.fonts!=null){g.find(".qd-fpp-font").closest("fieldset").show();g.find(".qd-fpp-font").empty();for(var s=0;s<u.fields.fonts.length;s++){var v=$('<label style="font-family:'+u.fields.fonts[s]+';" class="radio-inline"><input type="radio" name="qd_font_radio" value="'+u.fields.fonts[s]+'">'+u.fields.fonts[s]+"</label>");if(u.fields.fonts[s]=="Palace Script"||u.fields.fonts[s]=="Isabella Script")v.addClass("qd-fpp-big-font");v.appendTo(".qd-fpp-font")}g.find(".qd-fpp-font .radio-inline").first().find("input").addClass("required")}if(u.fields.illustrations!=null){g.find(".qd-illustration").closest("fieldset").show();g.find(".qd-illustration").empty();g.find(".qd-illustration").append('<option value="">Sem ilustração</option>');for(var s=0;s<u.fields.illustrations.length;s++){var h=u.fields.illustrations[s];g.find(".qd-illustration").append('<option value="'+h+'">'+h+"</option>");b.append('<img src="/arquivos/qd-stamp-'+h.toLowerCase().replaceSpecialChars().replace(" ","-")+'.png" class="img-flag" />')}g.find(".qd-illustration").select2({placeholder:"Sem ilustração",minimumResultsForSearch:Infinity,templateResult:function(e){if(!e.id)return e.text;var a=e.text.toLowerCase().replaceSpecialChars().replace(" ","-");var i="/arquivos/qd-stamp-"+a+".png";var s=$('<span><img src="'+i+'" class="img-flag" /> '+e.text+"</span>");s.find(".img-flag").css("width","40px");return s}});g.find(".qd-illustration").val("Sem ilustração").trigger("change.select2");g.find(".qd-illustration").closest(".input-group").addClass("filled")}if(u.fields.colors!=null){g.find(".qd-fpp-colors").closest("fieldset").show();g.find(".qd-fpp-colors").empty();g.find(".qd-fpp-colors").append('<option value="">Sem cor</option>');for(var s=0;s<u.fields.colors.length;s++){var q=u.fields.colors[s];g.find(".qd-fpp-colors").append('<option value="'+q+'">'+q+"</option>");b.append('<img src="/arquivos/personalizacao-cor-'+q.toLowerCase().replaceSpecialChars().replace(" ","-")+'.jpg" class="img-flag" />')}g.find(".qd-fpp-colors").select2({placeholder:"Sem cor",templateResult:function(e){if(!e.id)return e.text;var a=e.text.toLowerCase().replaceSpecialChars().replace(" ","-");var i="/arquivos/personalizacao-cor-"+a+".jpg";b.append('<img src="'+i+'" class="img-flag" />');var s=$('<span><img src="'+i+'" class="img-flag" /> '+e.text+"</span>");s.find(".img-flag").css("width","40px");return s}})}g.find('.qd-fpp-items input[type="radio"]').on("click",function(){$(".input-group-radio .radio-inline").removeClass("checked");$(this).closest(".radio-inline").addClass("checked");C(null,null,$(this).val(),$(this).val().toLowerCase().replace(" ","-"))});g.find(".qd-fpp-items .qd-illustration").on("change",function(){if($(this).val())$(this).closest(".input-group").addClass("filled");else $(this).closest(".input-group").removeClass("filled");if(vtxctx.categoryName.indexOf("Chupeta")>-1&&$(".qd-baby-name-second").is(":hidden")){var e=$(this).val().toLowerCase().replace("â","a").replaceSpecialChars().replace(" ","-");if(e=="sem-ilustracao"){$(".qd-fpp-image #qd_fpp_nome").find("img").remove();$(".qd-fpp-image #qd_fpp_nome").find(".qd-fpp-text").addClass("qd-fpp-no-img");return}var a="/arquivos/qd-stamp-"+e+".png";C(null,a,null)}});$(".qd_cart_auto").QD_buyButton({buyButton:g.find(".buy-button"),productPageCallback:function(){w(o,g,u)}});g.find(".modal-footer .buy-button").click(function(e){if($(e.target).attr("href")!="#")return;e.preventDefault();y(o,g)});g.find(".qd-fpp-items").removeClass("qd-loading")})}function C(e,a,i,s){if(!$(".qd-fpp-area #qd_fpp_nome").length)$(".qd-fpp-area").append($('<div id="qd_fpp_nome">'));wrapperCustomize=$(".qd-fpp-area #qd_fpp_nome");if(a){var t=wrapperCustomize.find("img").length?wrapperCustomize.find("img"):$("<img>").prependTo(wrapperCustomize);t.attr("src",a)}var d=$(".qd-fpp-show-font");var o=wrapperCustomize.find(".qd-fpp-text").length?wrapperCustomize.find(".qd-fpp-text"):$('<div class="qd-fpp-text"><span></span></div>').appendTo(wrapperCustomize);if(e){e=n(e,d);if($(".qd-baby-name-second").is(":hidden")){if(vtxctx.categoryName.indexOf("Chupeta")>-1){o.find("span").html(e.replace(/\s/gi,"<br>"));if(e!=" "){textFit(o,{minFontSize:16,maxFontSize:37})}}}}if(i){o.find("span").css("font-family",i.replaceSpecialChars());d.find("span").css("font-family",i.replaceSpecialChars())}if(s&&!(vtxctx.categoryName.indexOf("Chupeta")>-1||vtxctx.categoryName.indexOf("Mamadeira")>-1||vtxctx.categoryName.indexOf("Copo")>-1)){var l=$(".qd-fpp-preview-text");$('<img src="/arquivos/personalizacao-preview-'+s+'.png" />').load(function(e){l.show()}).error(function(e){l.hide()}).appendTo(l.find("span").empty());l.hide()}if(!wrapperCustomize.find("img").length)o.addClass("qd-fpp-no-img");else o.removeClass("qd-fpp-no-img");if(d.find("span").text()==" "){d.find("p").show();d.find("span").hide()}}function t(e,a,i){var s=null;var t=vtexjs.checkout.orderForm.items;for(var d=0;d<t.length;d++){if(t[d].id==e)s=d}if(s==null)return;vtexjs.checkout.addOffering(i.offering.id,s).done(function(e){vtexjs.checkout.addBundleItemAttachment(s,i.offering.id,i.name,a).done(function(e){$(window).trigger("QuatroDigital.bia_callback")})})}function y(e,i){var a=$(".qd-fpp-items .form-qd-v1");a.validate({rules:{},submitHandler:function(e){var a=$(e);if(!a.valid())i.find(".modal-footer .buy-button").attr("href","#");else{i.find(".modal-footer .buy-button").attr("href","/checkout/cart/add?sku="+x+"&qty=1&seller="+s+"&redirect=true&sc="+jssalesChannel);i.find(".modal-content").addClass("qd-loading")}i.find(".modal-footer .buy-button").click()},highlight:function(e,a,i){var s=$(e);s.addClass(a).removeClass(i);if(s.is(":radio"))s.parents(".input-group-radio").addClass(a+"-wrapper").removeClass(i+"-wrapper");else s.parent().addClass(a+"-wrapper").removeClass(i+"-wrapper")},unhighlight:function(e,a,i){var s=$(e);s.addClass(i).removeClass(a);if(s.is(":radio"))s.parents(".input-group-radio").addClass(i+"-wrapper").removeClass(a+"-wrapper");else s.parent().addClass(i+"-wrapper").removeClass(a+"-wrapper")},errorPlacement:function(){}});a.submit()}function w(e,i,a){$(window).one("orderFormUpdated.vtex",function(){var e={};if(a.fields.fonts!=null)e["Letra"]=i.find(".qd-fpp-font .checked input").val()||"*** NÃO ***";if(a.fields.text!=null)e["Texto"]=i.find(".qd-baby-name").val()||"*** NÃO ***";if(a.fields.text2!=null)e["Texto 2"]=i.find(".qd-baby-name-second").val()||"*** NÃO ***";if(a.fields.illustrations!=null)e["Figura"]=i.find(".qd-illustration").val()||"*** NÃO ***";if(a.fields.colors!=null)e["Cor da letra"]=i.find(".qd-fpp-colors").val()||"*** NÃO ***";if(a.fields.authorizeOpenPackage!=null)e["Autoriza abrir embalagem"]=i.find(".qd-authorize-remove-product").is(":checked")?"true":"false";t(x,e,a);i.find(".modal-body").addClass("qd-loading")});$(window).one("QuatroDigital.bia_callback",function(){$(document.body).removeClass(".qd-ddc-product-add-time").removeClass(".qd-ddc-product-add-time-v2");i.modal("hide");var e=$(".qd-v1-modal").first().clone().addClass("qd-fpp-success");var a='<a href="javascript: void(0);" class="qd-fpp-close" data-dismiss="modal">Fechar</a>';a+='<i class="fa fa-check-circle" aria-hidden="true"></i>';a+='<h5 class="qd-fpp-success-text">Produto adicionado com sucesso!</h5>';a+='<div class="product-qd-v1-buy-button"><a class="qd-fpp-success-btn" href="/checkout">Finalizar Compra</a></div>';a+='<a href="javascript: void(0);" class="qd-fpp-continue" data-dismiss="modal">Continuar comprando</a>';e.find(".modal-body").append(a);e.find(".modal-header, .modal-footer").remove();e.modal()})}function a(e){e.preventDefault();if(!x){alert("Por favor, selecione o modelo desejado.");return}var a=$(".qd-v1-modal").first().clone().addClass("qd-fpp-modal");a.find(".modal-header").append("<link href='//qd-cdn.github.io/flickakids-arquivos/CSS.fli.taw.product-customization-fonts.css' rel='stylesheet' type='text/css'>");a.find(".modal-header").append($("<h5></h5>").text($(".product-qd-v1-sku-selection-box .product-qd-v1-name").text()));a.find(".modal-header .close").addClass("qd-fpp-close").text("Não quero personalizar o produto");var i='<div class="row"><div class="col-xs-12 col-sm-5 qd-fpp-image"><div class="qd-fpp-area"></div></div><div class="col-xs-12 col-sm-7 qd-fpp-items"></div>';a.find(".modal-body").append(i);d(a.find(".qd-fpp-image"),x);var s='<div class="qd-fpp-show-font"><span></span><p>Para começar, digite um nome abaixo e selecione uma fonte.</p><p>(A visualização aparece aqui).</p></div>';s+='<form class="form-qd-v1">';s+='<fieldset class="qd-fpp-fieldset-text"><label>Digite o nome</label><div class="input-group"><input type="text" class="qd-baby-name form-control required" placeholder="Escreva aqui o nome do bebê" maxlength="18"  name="qd_form_baby_name"></div><div class="qd-fpp-preview-text">Preview: <span></span></div></fieldset>';s+='<fieldset class="qd-fpp-fieldset-text"><label>Digite o segundo nome</label><div class="input-group"><input type="text" class="qd-baby-name-second form-control required" placeholder="Escreva aqui o nome do bebê" maxlength="18"  name="qd_form_baby_name_second"></div><div class="qd-fpp-preview-text">Preview: <span></span></div></fieldset>';s+='<fieldset><label>Escolha a ilustração</label><div class="input-group"><select class="qd-illustration required" name="qd_form_illustration"></select></div></fieldset>';s+='<fieldset><label>Escolha a fonte</label><div class="qd-fpp-font input-group-radio"></div></fieldset>';s+='<fieldset><label>Escolha a cor</label><div class="input-group"><select class="qd-fpp-colors required"></select></div></fieldset>';s+='<fieldset><label class="checkbox"><input class="qd-authorize-remove-product required" type="checkbox" name="qd-form-authorize-remove-product" value="autorizado"> Autorizo a Flicka Kids a retirar o produto da embalagem, para realizar a personalização por mim escolhida.</label></fieldset>';s+="</form>";a.find(".qd-fpp-items").append(s);var t='<a href="javascript: void(0);" class="qd-fpp-close" data-dismiss="modal">Não quero personalizar o produto</a>';t+='<div class="qd-fpp-price">Valor com a personalização:<span class="total-price">R$ ---</span></div>';t+='<div class="product-qd-v1-buy-button"><a class="buy-button qd-fpp-modal-btn" href="#">Comprar personalizado</a></div>';a.find(".modal-footer").append(t);a.insertAfter($(".qd-v1-modal").first());a.on("hidden.bs.modal",function(e){$(this).remove()});a.modal();$(".qd-fpp-items select").on("change",function(){if($(this).val())$(this).closest(".input-group").addClass("filled");else $(this).closest(".input-group").removeClass("filled");if(!($(this).is(".qd-illustration")&&vtxctx.categoryName.indexOf("Chupeta")>-1))return});$('.qd-fpp-items input[type="radio"]').on("click",function(){$(".input-group-radio .radio-inline").removeClass("checked");$(this).closest(".radio-inline").addClass("checked");C(null,null,$(this).val().replaceSpecialChars())});$('input[type="text"], button',".qd-fpp-items").on("click keyup",function(){var e=$(this).closest("fieldset").find("input");if(e.val())e.closest(".input-group").addClass("filled");else e.closest(".input-group").removeClass("filled");if(e.is(".qd-baby-name")||e.is(".qd-baby-name-second")){var i=[];$("input.qd-baby-name, input.qd-baby-name-second").each(function(e,a){if($(a).is(":visible"))i.push($(a).val())});C(i)}});o(a)}function n(e,i){var s=0;while(e.length>i.find("span").length)i.addClass("row").append("<span>");if(e.length>1)i.find("span").addClass("col-sm-6");e.forEach(function(e,a){$(i.find("span")[a]).text(e.trim());s+=e.trim().length});if(s==0)i.html("<span></span><p>Para começar, digite um nome abaixo e selecione uma fonte.</p><p>(A visualização aparece aqui).</p>");else{i.find("p").hide();i.find("span").show()}return e[0]}});