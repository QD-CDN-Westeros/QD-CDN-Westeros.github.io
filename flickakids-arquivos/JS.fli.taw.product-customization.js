$(function(){function w(b,a){b.addClass("qd-loading");$.qdAjax({url:"/produto/sku/"+a}).done(function(a){a=a[0].Images;for(var e,d=0;d<a.length;d++)a[d][0].Name&&"personaliza"==a[d][0].Name.toLowerCase()&&(e=a[d][0].Path);e||(e=a[0][0].Path);b.prepend('<img class="sku-image" src="'+e.replace(/(ids\/\d+)-\d+-\d+/,"$1-350-350")+'" />');b.removeClass("qd-loading")})}function x(b){b.find(".qd-fpp-items").addClass("qd-loading");vtexjs.checkout.simulateShipping([{id:k,quantity:1,seller:m}],"","BRA").done(function(a){var c=
a.items,e=null;for(a=0;a<c.length;a++)c[a].id==k&&(e=a);if(null!=e){for(var d,f=[],q,r,l,h,m,n=0;n<c[e].offerings.length;n++)for(d=c[e].offerings[n].attachmentOfferings,a=0;a<d.length;a++)d[a].schema&&d[a].schema["Autoriza abrir embalagem"]&&(m=d[a].schema["Autoriza abrir embalagem"],q=d[a].schema.Texto||null,text2=d[a].schema["Texto 2"]||null,r=d[a].schema.Letra?d[a].schema.Letra.domain:null,l=d[a].schema.Figura?d[a].schema.Figura.domain:null,h=d[a].schema["Cor da letra"]?d[a].schema["Cor da letra"].domain:
null,(q||text2||r||l||h)&&f.push({name:d[a].name,offering:c[e].offerings[n],fields:{authorizeOpenPackage:m,text:q,text2:text2,fonts:r,illustrations:l,colors:h}}));if(f.length){var g=f[0];a=c[e].sellingPrice+g.offering.price;b.find(".qd-fpp-price .total-price").text("R$ "+qd_number_format(a/100,2,",","."));null!=g.fields.authorizeOpenPackage&&b.find(".qd-authorize-remove-product").closest("fieldset").show();null!=g.fields.text&&b.find(".qd-baby-name").closest("fieldset").show().find("label").text("Digite o nome");
null!=g.fields.text2&&(b.find(".qd-baby-name").closest("fieldset").find("label").text("Digite o nome - PRODUTO 1"),b.find(".qd-baby-name-second").closest("fieldset").show().find("label").text("Digite o nome - PRODUTO 2"));if(null!=g.fields.fonts){b.find(".qd-fpp-font").closest("fieldset").show();b.find(".qd-fpp-font").empty();for(a=0;a<g.fields.fonts.length;a++)c=$('<label style="font-family:'+g.fields.fonts[a]+';" class="radio-inline"><input type="radio" name="qd_font_radio" value="'+g.fields.fonts[a]+
'">'+g.fields.fonts[a]+"</label>"),"Palace Script"!=g.fields.fonts[a]&&"Isabella Script"!=g.fields.fonts[a]||c.addClass("qd-fpp-big-font"),c.appendTo(".qd-fpp-font");b.find(".qd-fpp-font .radio-inline").first().find("input").addClass("required")}if(null!=g.fields.illustrations){b.find(".qd-illustration").closest("fieldset").show();b.find(".qd-illustration").empty();b.find(".qd-illustration").append('<option value="">Sem ilustra\u00e7\u00e3o</option>');for(a=0;a<g.fields.illustrations.length;a++)c=
g.fields.illustrations[a],b.find(".qd-illustration").append('<option value="'+c+'">'+c+"</option>"),t.append('<img src="/arquivos/qd-stamp-'+c.toLowerCase().replaceSpecialChars().replace(" ","-")+'.png" class="img-flag" />');b.find(".qd-illustration").select2({placeholder:"Sem ilustra\u00e7\u00e3o",minimumResultsForSearch:Infinity,templateResult:function(a){if(!a.id)return a.text;var b=a.text.toLowerCase().replaceSpecialChars().replace(" ","-");a=$('<span><img src="'+("/arquivos/qd-stamp-"+b+".png")+
'" class="img-flag" /> '+a.text+"</span>");a.find(".img-flag").css("width","40px");return a}});b.find(".qd-illustration").val("Sem ilustra\u00e7\u00e3o").trigger("change.select2");b.find(".qd-illustration").closest(".input-group").addClass("filled")}if(null!=g.fields.colors){b.find(".qd-fpp-colors").closest("fieldset").show();b.find(".qd-fpp-colors").empty();b.find(".qd-fpp-colors").append('<option value="">Sem cor</option>');for(a=0;a<g.fields.colors.length;a++)c=g.fields.colors[a],b.find(".qd-fpp-colors").append('<option value="'+
c+'">'+c+"</option>"),t.append('<img src="/arquivos/personalizacao-cor-'+c.toLowerCase().replaceSpecialChars().replace(" ","-")+'.jpg" class="img-flag" />');b.find(".qd-fpp-colors").select2({placeholder:"Sem cor",templateResult:function(a){if(!a.id)return a.text;var b="/arquivos/personalizacao-cor-"+a.text.toLowerCase().replaceSpecialChars().replace(" ","-")+".jpg";t.append('<img src="'+b+'" class="img-flag" />');a=$('<span><img src="'+b+'" class="img-flag" /> '+a.text+"</span>");a.find(".img-flag").css("width",
"40px");return a}})}b.find('.qd-fpp-items input[type="radio"]').on("click",function(){$(".input-group-radio .radio-inline").removeClass("checked");$(this).closest(".radio-inline").addClass("checked");p({font:$(this).val(),preview:$(this).val().toLowerCase().replace(" ","-")})});b.find(".qd-fpp-items .qd-illustration").on("change",function(){$(this).val()?$(this).closest(".input-group").addClass("filled"):$(this).closest(".input-group").removeClass("filled");var a=$(this).val().toLowerCase().replace("\u00e2",
"a").replaceSpecialChars().replace(" ","-"),b="/arquivos/qd-stamp-"+a+".png";"sem-ilustracao"==a&&($(".qd-fpp-image #qd_fpp_nome").find("img").remove(),$(".qd-fpp-image #qd_fpp_nome").find(".qd-fpp-text").addClass("qd-fpp-no-img"),b=null);p({img:b})});$(".qd_cart_auto").QD_buyButton({buyButton:b.find(".buy-button"),productPageCallback:function(){y(f,b,g)}});b.find(".modal-footer .buy-button").click(function(a){"#"==$(a.target).attr("href")&&(a.preventDefault(),z(f,b))})}else b.find(".qd-fpp-items").html('<p class="qd-error"> Servi\u00e7o de personaliza\u00e7\u00e3o de SKU n\u00e3o encontrado.</p>');
b.find(".qd-fpp-items").removeClass("qd-loading")}})}function A(b,a,c,e){$(".qd-fpp-area #qd_fpp_nome").length||$(".qd-fpp-area").append($('<div id="qd_fpp_nome">'));var d=$(".qd-fpp-show-font"),f=$(".qd-fpp-area #qd_fpp_nome"),h=f.find(".qd-fpp-text").length?f.find(".qd-fpp-text"):$('<div class="qd-fpp-text"><span></span></div>').appendTo(f);b&&(b=B(b,d),$(".qd-baby-name-second").is(":hidden")&&-1<vtxctx.categoryName.indexOf("Chupeta")&&(h.find("span").html(b.replace(/\s/gi,"<br>"))," "!=b&&textFit(h,
{minFontSize:16,maxFontSize:37})));b=f.find("img").length?f.find("img"):$("<img>").prependTo(f);var k=d.find("img").length?d.find("img"):$("<img><br>").prependTo(d.find("span"));a?(-1<vtxctx.categoryName.indexOf("Chupeta")&&$(".qd-baby-name-second").is(":hidden")&&b.attr("src",a),k.attr("src",a),d.find("p").hide(),d.find("span").show()):(b.remove(),k.remove());c&&(h.find("span").css("font-family",c.replaceSpecialChars()),d.find("span").css("font-family",c.replaceSpecialChars()));if(e&&!(-1<vtxctx.categoryName.indexOf("Chupeta")||
-1<vtxctx.categoryName.indexOf("Mamadeira")||-1<vtxctx.categoryName.indexOf("Copo"))){var l=$(".qd-fpp-preview-text");$('<img src="/arquivos/personalizacao-preview-'+e+'.png" />').load(function(a){l.show()}).error(function(a){l.hide()}).appendTo(l.find("span").empty());l.hide()}f.find("img").length?h.removeClass("qd-fpp-no-img"):h.addClass("qd-fpp-no-img");""!=d.find("span").text().trim()||d.find("img").length||(d.find("p").show(),d.find("span").hide())}function C(b,a,c){for(var e=null,d=vtexjs.checkout.orderForm.items,
f=0;f<d.length;f++)d[f].id==b&&(e=f);null!=e&&vtexjs.checkout.addOffering(c.offering.id,e).done(function(b){vtexjs.checkout.addBundleItemAttachment(e,c.offering.id,c.name,a).done(function(a){$(window).trigger("QuatroDigital.bia_callback")})})}function z(b,a){var c=$(".qd-fpp-items .form-qd-v1");c.validate({rules:{},submitHandler:function(b){$(b).valid()?(a.find(".modal-footer .buy-button").attr("href","/checkout/cart/add?sku="+k+"&qty=1&seller="+m+"&redirect=true&sc="+jssalesChannel),a.find(".modal-content").addClass("qd-loading")):
a.find(".modal-footer .buy-button").attr("href","#");a.find(".modal-footer .buy-button").click()},highlight:function(a,b,c){a=$(a);a.addClass(b).removeClass(c);a.is(":radio")?a.parents(".input-group-radio").addClass(b+"-wrapper").removeClass(c+"-wrapper"):a.parent().addClass(b+"-wrapper").removeClass(c+"-wrapper");a.is(".qd-authorize-remove-product")&&a.closest("fieldset").addClass("bg-danger").css("padding","0 8px")},unhighlight:function(a,b,c){a=$(a);a.addClass(c).removeClass(b);a.is(":radio")?
a.parents(".input-group-radio").addClass(c+"-wrapper").removeClass(b+"-wrapper"):a.parent().addClass(c+"-wrapper").removeClass(b+"-wrapper");a.is(".qd-authorize-remove-product")&&a.closest("fieldset").removeClass("bg-danger").css("padding","0")},errorPlacement:function(){}});c.submit()}function y(b,a,c){$(window).one("orderFormUpdated.vtex",function(){var b={};null!=c.fields.fonts&&(b.Letra=a.find(".qd-fpp-font .checked input").val()||"*** N\u00c3O ***");null!=c.fields.text&&(b.Texto=a.find(".qd-baby-name").val()||
"*** N\u00c3O ***");null!=c.fields.text2&&(b["Texto 2"]=a.find(".qd-baby-name-second").val()||"*** N\u00c3O ***");null!=c.fields.illustrations&&(b.Figura=a.find(".qd-illustration").val()||"*** N\u00c3O ***");null!=c.fields.colors&&(b["Cor da letra"]=a.find(".qd-fpp-colors").val()||"*** N\u00c3O ***");null!=c.fields.authorizeOpenPackage&&(b["Autoriza abrir embalagem"]=a.find(".qd-authorize-remove-product").is(":checked")?"true":"false");C(k,b,c);a.find(".modal-body").addClass("qd-loading")});$(window).one("QuatroDigital.bia_callback",
function(){$(document.body).removeClass(".qd-ddc-product-add-time").removeClass(".qd-ddc-product-add-time-v2");a.modal("hide");var b=$(".qd-v1-modal").first().clone().addClass("qd-fpp-success");b.find(".modal-body").append('<a href="javascript: void(0);" class="qd-fpp-close" data-dismiss="modal">Fechar</a><i class="fa fa-check-circle" aria-hidden="true"></i><h5 class="qd-fpp-success-text">Produto adicionado com sucesso!</h5><div class="product-qd-v1-buy-button"><a class="qd-fpp-success-btn" href="/checkout">Finalizar Compra</a></div><a href="javascript: void(0);" class="qd-fpp-continue" data-dismiss="modal">Continuar comprando</a>');
b.find(".modal-header, .modal-footer").remove();b.modal()})}function u(b){b.preventDefault();k?(b=$(".qd-v1-modal").first().clone().addClass("qd-fpp-modal"),b.find(".modal-header").append("<link href='//qd-cdn.github.io/flickakids-arquivos/CSS.fli.taw.product-customization-fonts.css' rel='stylesheet' type='text/css'>"),b.find(".modal-header").append($("<h5></h5>").text($(".product-qd-v1-sku-selection-box .product-qd-v1-name").text())),b.find(".modal-header .close").addClass("qd-fpp-close").text("N\u00e3o quero personalizar o produto"),
b.find(".modal-body").append('<div class="row"><div class="col-xs-12 col-sm-5 qd-fpp-image"><div class="qd-fpp-area"></div></div><div class="col-xs-12 col-sm-7 qd-fpp-items"></div>'),w(b.find(".qd-fpp-image"),k),b.find(".qd-fpp-items").append('<div class="qd-fpp-show-font"><span></span><p>Para come\u00e7ar, digite um nome abaixo e selecione uma fonte.</p><p>(A visualiza\u00e7\u00e3o aparece aqui).</p></div><form class="form-qd-v1"><fieldset class="qd-fpp-fieldset-text"><label></label><div class="input-group"><input type="text" class="qd-baby-name form-control required" placeholder="Escreva aqui o nome do beb\u00ea" maxlength="18"  name="qd_form_baby_name"></div><div class="qd-fpp-preview-text">Preview: <span></span></div></fieldset><fieldset class="qd-fpp-fieldset-text"><label></label><div class="input-group"><input type="text" class="qd-baby-name-second form-control required" placeholder="Escreva aqui o nome do beb\u00ea" maxlength="18"  name="qd_form_baby_name_second"></div><div class="qd-fpp-preview-text">Preview: <span></span></div></fieldset><fieldset><label>Escolha a ilustra\u00e7\u00e3o</label><div class="input-group"><select class="qd-illustration required" name="qd_form_illustration"></select></div></fieldset><fieldset><label>Escolha a fonte</label><div class="qd-fpp-font input-group-radio"></div></fieldset><fieldset><label>Escolha a cor</label><div class="input-group"><select class="qd-fpp-colors required"></select></div></fieldset><fieldset><label class="checkbox"><input class="qd-authorize-remove-product required" type="checkbox" name="qd-form-authorize-remove-product" value="autorizado"> Autorizo a Flicka Kids a retirar o produto da embalagem, para realizar a personaliza\u00e7\u00e3o por mim escolhida.</label></fieldset></form>'),
b.find(".modal-footer").append('<a href="javascript: void(0);" class="qd-fpp-close" data-dismiss="modal">N\u00e3o quero personalizar o produto</a><div class="qd-fpp-price">Valor com a personaliza\u00e7\u00e3o:<span class="total-price">R$ ---</span></div><div class="product-qd-v1-buy-button"><a class="buy-button qd-fpp-modal-btn" href="#">Comprar personalizado</a></div>'),b.insertAfter($(".qd-v1-modal").first()),b.on("hidden.bs.modal",function(a){$(this).remove()}),b.modal(),$(".qd-fpp-items select").on("change",
function(){$(this).val()?$(this).closest(".input-group").addClass("filled"):$(this).closest(".input-group").removeClass("filled");$(this).is(".qd-illustration")&&vtxctx.categoryName.indexOf("Chupeta")}),$('.qd-fpp-items input[type="radio"]').on("click",function(){$(".input-group-radio .radio-inline").removeClass("checked");$(this).closest(".radio-inline").addClass("checked");p({font:$(this).val().replaceSpecialChars()})}),$('input[type="text"], button',".qd-fpp-items").on("click keyup",function(){var a=
$(this).closest("fieldset").find("input");a.val()?a.closest(".input-group").addClass("filled"):a.closest(".input-group").removeClass("filled");if(a.is(".qd-baby-name")||a.is(".qd-baby-name-second")){var b=[];$("input.qd-baby-name, input.qd-baby-name-second").each(function(a,c){$(c).is(":visible")&&b.push($(c).val())});p({text:b})}}),x(b)):alert("Por favor, selecione o modelo desejado.")}function B(b,a){for(var c=0;b.length>a.find("span").length;)a.addClass("row").append("<span>");1<b.length&&a.find("span").addClass("col-sm-6");
b.forEach(function(b,d){$(a.find("span")[d]).text(b.trim());c+=b.trim().length});a.find("img").length&&c++;0!==c&&(a.find("p").hide(),a.find("span").show());return b[0]}function p(b){$.extend(h,h,b);A(h.text,h.img,h.font,h.preview)}var h={text:null,img:null,font:null,preview:null};if(!$(document.body).is(".product-kit")){"Personalizados"==vtxctx.departmentName&&$(document.body).addClass("qd-fpp-product-page");var v=$('<a href="#" class="qd-fpp-btn">Personalizar</a>').click(u);$(".product-qd-v1-sku-selection-box .product-qd-v1-buy-button").prepend(v);
$(".qd-fpp-banner").click(u);var t=$('<div class="qd-fpp-pre-load" style="width:1px;height:1px;overflow:hidden;opacity:0.01;"><br /></div>').insertAfter(v),k=null,m=null;if(1<skuJson.skus.length)$(window).on("skuSelected.vtex",function(b,a,c){k=c.sku;m=c.sellerId});else k=skuJson.skus[0].sku,m=skuJson.skus[0].sellerId}});