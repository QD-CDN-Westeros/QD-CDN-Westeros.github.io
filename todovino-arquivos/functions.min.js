!function(){var e="close";$(document).ready((function(){var n=$.cookie("mz-smart-newsletter")||0;if(!(parseInt(n)>=2)){var a=$(".qd-v1-modal-newsletter");a.find(".qd-v1-modal-newsletter-step-1").show(),a.modal(),a.on("hidden.bs.modal",(function(){window.parent.postMessage("QdSn1Msg|"+e,"*"),n=parseInt(n)+1,$.cookie("mz-smart-newsletter",n,{path:"/",expires:30})})),$(".qd-content-coupon").html((location.search.match(/code=([^&]+)/i)||[""]).pop())}})),$((function(){var e=$("form"),n=e.find("[name=qd_form_email]");e.validate({rules:{email:{email:!0}},submitHandler:function(e){var a=$(e);if(a.valid()){var t=a.find("[name]");n=n.filter(t),a.addClass("qd-loading");var s=function(e){$.ajax({url:"//api.ipify.org?format=jsonp",dataType:"jsonp",success:function(e){s(e.ip)},error:function(){$.ajax({url:"//www.telize.com/jsonip",dataType:"jsonp",success:function(e){s(e.ip)},error:function(e){s(null)}})}});var t=a.serializeObject(),s=function(s){t.userId=e,t.ip=s,t.id=(n.val()||"").toLowerCase().replace(/[^a-z0-9]/gi,(function(e){return"-"+e.charCodeAt(0)+"-"})),$.ajax({url:"/api/dataentities/NL/documents/",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(t),success:function(e){a.addClass("qd-form-success"),a.trigger("QD.crmSuccess",[e])},error:function(e){"0"==e.status||"304"==e.status?alert("Este e-mail já está cadastrado na newsletter!"):alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){a.removeClass("qd-loading")}})}};return $.ajax({url:"/api/dataentities/CL/documents/search?email="+(n.val()||"---"),type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(e){e.length?s(e[0].id):s(null)},error:function(){s(null)}}),!1}},errorPlacement:function(e,n){}})})),$(window).on("QD.crmSuccess",(function(n,a){$(".qd-v1-modal-newsletter");e="success"}))}();