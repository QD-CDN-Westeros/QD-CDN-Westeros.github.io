(function(c){"object"===typeof module&&"object"===typeof module.exports?module.exports=c(require("jquery"),window,document):c(jQuery,window,document)})(function(c,n,m,t){function p(a,b){var d=this;this.settings=b;this.elems={};this.element=a;this._cssClasses=["chocolat-open","chocolat-in-container","chocolat-cover","chocolat-zoomable","chocolat-zoomed"];!this.settings.setTitle&&a.data("chocolat-title")&&(this.settings.setTitle=a.data("chocolat-title"));this.element.find(this.settings.imageSelector).each(function(){d.settings.images.push({title:c(this).attr("title"),
src:c(this).attr(d.settings.imageSource),height:!1,width:!1})});this.element.find(this.settings.imageSelector).each(function(a){c(this).off("click.chocolat").on("click.chocolat",function(b){d.init(a);b.preventDefault()})});return this}var q=0;c.extend(p.prototype,{init:function(a){this.settings.initialized||(this.setDomContainer(),this.markup(),this.events(),this.settings.lastImage=this.settings.images.length-1,this.settings.initialized=!0);this.settings.afterInitialize.call(this);return this.load(a)},
preload:function(a){var b=c.Deferred();if("undefined"!==typeof this.settings.images[a]){var d=new Image;d.onload=function(){b.resolve(d)};d.src=this.settings.images[a].src;return b}},load:function(a){var b=this;this.settings.fullScreen&&this.openFullScreen();if(this.settings.currentImage!==a){this.elems.overlay.fadeIn(this.settings.duration);this.elems.wrapper.fadeIn(this.settings.duration);this.elems.domContainer.addClass("chocolat-open");this.settings.timer=setTimeout(function(){"undefined"!=typeof b.elems&&
c.proxy(b.elems.loader.fadeIn(),b)},this.settings.duration);var d=this.preload(a).then(function(c){return b.place(a,c)}).then(function(c){return b.appear(a)}).then(function(a){b.zoomable();b.settings.afterImageLoad.call(b)}),f=a+1;"undefined"!=typeof this.settings.images[f]&&this.preload(f);return d}},place:function(a,b){this.settings.currentImage=a;this.description();this.pagination();this.arrows();this.storeImgSize(b,a);var c=this.fit(a,this.elems.wrapper);return this.center(c.width,c.height,c.left,
c.top,0)},center:function(a,b,c,f,g){return this.elems.content.css("overflow","visible").animate({width:a,height:b,left:c,top:f},g).promise()},appear:function(a){var b=this;clearTimeout(this.settings.timer);this.elems.loader.stop().fadeOut(300,function(){b.elems.img.attr("src",b.settings.images[a].src)})},fit:function(a,b){var d=this.settings.images[a].height,f=this.settings.images[a].width,g=c(b).height(),l=c(b).width(),k=this.getOutMarginH();var e=this.getOutMarginW();e=l-e;var h=g-k;k=d/f;"cover"==
this.settings.imageSize?k<g/l?(e=g,h=e/k):(h=l,e=h*k):"native"==this.settings.imageSize?(e=d,h=f):(k>h/e?(e=h,h=e/k):(h=e,e=h*k),"default"===this.settings.imageSize&&(h>=f||e>=d)&&(h=f,e=d));return{height:e,width:h,top:(g-e)/2,left:(l-h)/2}},change:function(a){this.zoomOut(0);this.zoomable();a=this.settings.currentImage+parseInt(a);if(a>this.settings.lastImage){if(this.settings.loop)return this.load(0)}else if(0>a){if(this.settings.loop)return this.load(this.settings.lastImage)}else return this.load(a)},
arrows:function(){this.settings.loop?c([this.elems.left[0],this.elems.right[0]]).addClass("active"):this.settings.linkImages?(this.settings.currentImage==this.settings.lastImage?this.elems.right.removeClass("active"):this.elems.right.addClass("active"),0===this.settings.currentImage?this.elems.left.removeClass("active"):this.elems.left.addClass("active")):c([this.elems.left[0],this.elems.right[0]]).removeClass("active")},description:function(){this.elems.description.html(this.settings.images[this.settings.currentImage].title)},
pagination:function(){this.elems.pagination.html(this.settings.currentImage+1+" "+this.settings.separator2+(this.settings.lastImage+1))},storeImgSize:function(a,b){"undefined"===typeof a||this.settings.images[b].height&&this.settings.images[b].width||(this.settings.images[b].height=a.height,this.settings.images[b].width=a.width)},close:function(){if(this.settings.fullscreenOpen)this.exitFullScreen();else{var a=this,b=c.when(c([this.elems.overlay[0],this.elems.loader[0],this.elems.wrapper[0]]).fadeOut(200)).done(function(){a.elems.domContainer.removeClass("chocolat-open")});
this.settings.currentImage=!1;return b}},destroy:function(){this.element.removeData();this.element.find(this.settings.imageSelector).off("click.chocolat");this.settings.initialized&&(this.settings.fullscreenOpen&&this.exitFullScreen(),this.settings.currentImage=!1,this.settings.initialized=!1,this.elems.domContainer.removeClass(this._cssClasses.join(" ")),this.elems.wrapper.remove())},getOutMarginW:function(){var a=this.elems.left.outerWidth(!0),b=this.elems.right.outerWidth(!0);return a+b},getOutMarginH:function(){return this.elems.top.outerHeight(!0)+
this.elems.bottom.outerHeight(!0)},markup:function(){this.elems.domContainer.addClass("chocolat-open "+this.settings.className);"cover"==this.settings.imageSize&&this.elems.domContainer.addClass("chocolat-cover");this.settings.container!==n&&this.elems.domContainer.addClass("chocolat-in-container");this.elems.wrapper=c("<div/>",{"class":"chocolat-wrapper",id:"chocolat-content-"+this.settings.setIndex}).appendTo(this.elems.domContainer);this.elems.overlay=c("<div/>",{"class":"chocolat-overlay"}).appendTo(this.elems.wrapper);
this.elems.loader=c("<div/>",{"class":"chocolat-loader"}).appendTo(this.elems.wrapper);this.elems.content=c("<div/>",{"class":"chocolat-content"}).appendTo(this.elems.wrapper);this.elems.img=c("<img/>",{"class":"chocolat-img",src:""}).appendTo(this.elems.content);this.elems.top=c("<div/>",{"class":"chocolat-top"}).appendTo(this.elems.wrapper);this.elems.left=c("<div/>",{"class":"chocolat-left"}).appendTo(this.elems.wrapper);this.elems.right=c("<div/>",{"class":"chocolat-right"}).appendTo(this.elems.wrapper);
this.elems.bottom=c("<div/>",{"class":"chocolat-bottom"}).appendTo(this.elems.wrapper);this.elems.close=c("<span/>",{"class":"chocolat-close"}).appendTo(this.elems.top);this.elems.fullscreen=c("<span/>",{"class":"chocolat-fullscreen"}).appendTo(this.elems.bottom);this.elems.description=c("<span/>",{"class":"chocolat-description"}).appendTo(this.elems.bottom);this.elems.pagination=c("<span/>",{"class":"chocolat-pagination"}).appendTo(this.elems.bottom);this.elems.setTitle=c("<span/>",{"class":"chocolat-set-title",
html:this.settings.setTitle}).appendTo(this.elems.bottom);this.settings.afterMarkup.call(this)},openFullScreen:function(){var a=this.elems.wrapper.closest(".chocolat-in-container").length?this.elems.wrapper.closest(".chocolat-in-container")[0]:this.elems.wrapper[0];a.requestFullscreen?(this.settings.fullscreenOpen=!0,a.requestFullscreen()):a.mozRequestFullScreen?(this.settings.fullscreenOpen=!0,a.mozRequestFullScreen()):a.webkitRequestFullscreen?(this.settings.fullscreenOpen=!0,a.webkitRequestFullscreen()):
a.msRequestFullscreen?(a.msRequestFullscreen(),this.settings.fullscreenOpen=!0):this.settings.fullscreenOpen=!1},exitFullScreen:function(){m.exitFullscreen?(m.exitFullscreen(),this.settings.fullscreenOpen=!1):m.mozCancelFullScreen?(m.mozCancelFullScreen(),this.settings.fullscreenOpen=!1):m.webkitExitFullscreen?(m.webkitExitFullscreen(),this.settings.fullscreenOpen=!1):m.msExitFullscreen?(m.msExitFullscreen(),this.settings.fullscreenOpen=!1):this.settings.fullscreenOpen=!0},events:function(){var a=
this;c(m).off("keydown.chocolat").on("keydown.chocolat",function(b){a.settings.initialized&&(37==b.keyCode?a.change(-1):39==b.keyCode?a.change(1):27==b.keyCode&&a.close())});this.elems.wrapper.find(".chocolat-right").off("click.chocolat").on("click.chocolat",function(){a.change(1)});this.elems.wrapper.find(".chocolat-left").off("click.chocolat").on("click.chocolat",function(){return a.change(-1)});c([this.elems.overlay[0],this.elems.close[0]]).off("click.chocolat").on("click.chocolat",function(){return a.close()});
this.elems.fullscreen.off("click.chocolat").on("click.chocolat",function(){a.settings.fullscreenOpen?a.exitFullScreen():a.openFullScreen()});if(a.settings.backgroundClose)this.elems.overlay.off("click.chocolat").on("click.chocolat",function(){return a.close()});this.elems.wrapper.off("click.chocolat").on("click.chocolat",function(b){return a.zoomOut(b)});this.elems.wrapper.find(".chocolat-img").off("click.chocolat").on("click.chocolat",function(b){if(null===a.settings.initialZoomState&&a.elems.domContainer.hasClass("chocolat-zoomable"))return b.stopPropagation(),
a.zoomIn(b)});this.elems.wrapper.mousemove(function(b){if(null!==a.settings.initialZoomState&&!a.elems.img.is(":animated")){var d=c(this).offset(),f=c(this).height(),g=c(this).width(),l=a.settings.images[a.settings.currentImage],k=l.width;l=l.height;d=[b.pageX-g/2-d.left,b.pageY-f/2-d.top];var e=0;if(k>g){var h=a.settings.zoomedPaddingX(k,g);e=d[0]/(g/2);e*=(k-g)/2+h}g=0;l>f&&(k=a.settings.zoomedPaddingY(l,f),g=d[1]/(f/2),g*=(l-f)/2+k);f={"margin-left":-e+"px","margin-top":-g+"px"};"undefined"!==
typeof b.duration?c(a.elems.img).stop(!1,!0).animate(f,b.duration):c(a.elems.img).stop(!1,!0).css(f)}});c(n).on("resize",function(){a.settings.initialized&&!1!==a.settings.currentImage&&a.debounce(50,function(){var b=a.fit(a.settings.currentImage,a.elems.wrapper);a.center(b.width,b.height,b.left,b.top,0);a.zoomable()})})},zoomable:function(){var a=this.settings.images[this.settings.currentImage],b=this.elems.wrapper.width(),c=this.elems.wrapper.height();b=this.settings.enableZoom&&(a.width>b||a.height>
c)?!0:!1;a=this.elems.img.width()>a.width||this.elems.img.height()>a.height;b&&!a?this.elems.domContainer.addClass("chocolat-zoomable"):this.elems.domContainer.removeClass("chocolat-zoomable")},zoomIn:function(a){this.settings.initialZoomState=this.settings.imageSize;this.settings.imageSize="native";var b=c.Event("mousemove");b.pageX=a.pageX;b.pageY=a.pageY;b.duration=this.settings.duration;this.elems.wrapper.trigger(b);this.elems.domContainer.addClass("chocolat-zoomed");a=this.fit(this.settings.currentImage,
this.elems.wrapper);return this.center(a.width,a.height,a.left,a.top,this.settings.duration)},zoomOut:function(a,b){if(null!==this.settings.initialZoomState&&!1!==this.settings.currentImage){b=b||this.settings.duration;this.settings.imageSize=this.settings.initialZoomState;this.settings.initialZoomState=null;this.elems.img.animate({margin:0},b);this.elems.domContainer.removeClass("chocolat-zoomed");var c=this.fit(this.settings.currentImage,this.elems.wrapper);return this.center(c.width,c.height,c.left,
c.top,b)}},setDomContainer:function(){this.elems.domContainer=this.settings.container===n?c("body"):c(this.settings.container)},debounce:function(a,b){clearTimeout(this.settings.timerDebounce);this.settings.timerDebounce=setTimeout(function(){b()},a)},api:function(){var a=this;return{open:function(b){b=parseInt(b)||0;return a.init(b)},close:function(){return a.close()},next:function(){return a.change(1)},prev:function(){return a.change(-1)},"goto":function(b){return a.open(b)},current:function(){return a.settings.currentImage},
place:function(){return a.place(a.settings.currentImage,a.settings.duration)},destroy:function(){return a.destroy()},set:function(b,c){return a.settings[b]=c},get:function(b){return a.settings[b]},getElem:function(b){return a.elems[b]}}}});var r={container:n,imageSelector:".chocolat-image",className:"",imageSize:"default",initialZoomState:null,fullScreen:!1,loop:!1,linkImages:!0,duration:300,setTitle:"",separator2:"/",setIndex:0,firstImage:0,lastImage:!1,currentImage:!1,initialized:!1,timer:!1,timerDebounce:!1,
images:[],enableZoom:!0,imageSource:"href",afterInitialize:function(){},afterMarkup:function(){},afterImageLoad:function(){},zoomedPaddingX:function(a,b){return 0},zoomedPaddingY:function(a,b){return 0}};c.fn.Chocolat=function(a){return this.each(function(){q++;var b=c.extend(!0,{},r,a,{setIndex:q});c.data(this,"chocolat")||c.data(this,"chocolat",new p(c(this),b))})};return c.fn.Chocolat});