{"version":3,"sources":["webpack:///./src/js/store/desktop/account/index.js"],"names":["VTEX_STATUS_TO_SHOW","Account","this","changePageTitle","setHandledsToWindow","userOrders","setHandled","location","hash","fetchUserOrdersAndUpdateTheOrderElements","title","document","querySelector","textContent","setPageTitle","window","addEventListener","e","mutationsList","observer","callback","mutation","type","target","targetNode","MutationObserver","observeCallback","observe","childList","subtree","productName","productId","quantity","order","orderIndex","selectItemsApp","products","container","parentElement","customData","customApps","filter","customApp","id","JSON","parse","fields","products_data","innerHTML","product","isCustom","map","customAttributes","createOrderProduct","join","querySelectorAll","customProductsNames","includes","forEach","classList","add","totalName","totalPrice","createElement","setAttribute","selectedCourierAPP","insuranceAPP","transporterTotal","insuranceTotal","insuranceTotalElement","transporterTotalElement","orderHeader","courier_data","deliveryTypeSelected","priceFormatted","total","createTotal","insertBefore","children","productItem","items","item","name","orderCard","Object","entries","productInsurance","labelInsuredItem","productInfoContainer","insuranceText","totalInsuranceFormatted","appendChild","moving_date","split","reverse","observeOrderSection","addedNodes","Element","matches","orderStatusElement","hasOwnProperty","style","display","hideCustomProducts","sellerOrderIDElements","Promise","all","orderID","replace","fetch","json","data","orders","index","addIDToProducts","addDateOfDelivery","addOrderProducts","addInsuranceInfo","addTotals","showOrders"],"mappings":"ooEAEA,IAAMA,EAAsB,CAC1B,qBAAsB,kBACtB,qBAAsB,qBACtB,oBAAqB,qBACrB,0BAA2B,aAGvBC,E,WACJ,c,4FAAc,SACZC,KAAKC,kBACLD,KAAKE,sBAELF,KAAKG,WAAa,GAElBH,KAAKI,aAEiB,aAAlBC,SAASC,MACXN,KAAKO,2C,8DAIIC,GACaC,SAASC,cAC/B,+CAGcC,YAAcH,I,wCAIR,aAAlBH,SAASC,MACXN,KAAKY,aAAa,qB,4CAIA,WACpBC,OAAOC,iBAAiB,aAAc,SAAAC,GAAC,OAAI,EAAKd,sB,sCAIlCe,EAAeC,EAAUC,GAAU,Q,6nBAAA,CAC5BF,GAD4B,IACjD,2BAAoC,KAA3BG,EAA2B,QACZ,cAAlBA,EAASC,MACXF,EAASC,EAAUF,IAH0B,iC,0CAQ/BI,EAAQH,GAAU,WAE9BI,EAAab,SAASC,cAAcW,GAMzB,IAAIE,iBAAiB,SAACP,EAAeC,GAAhB,OACpC,EAAKO,gBAAgBR,EAAeC,EAAUC,KAIvCO,QAAQH,EARF,CAAEI,WAAW,EAAMC,SAAS,M,4CAWY,IAApCC,EAAoC,EAApCA,YAAaC,EAAuB,EAAvBA,UAAWC,EAAY,EAAZA,SAC3C,wGACoFD,EADpF,ojBAkBYD,EAlBZ,oHAuBUE,EAvBV,iE,uCA8BeC,EAAOC,GAAY,IAQ5BC,EAIAC,EAZ4B,OAI5BC,EAHe1B,SAASC,cAAT,oCACUsB,EADV,yBAGUI,cAE1BL,EAAMM,aAELJ,EAAiBF,EAAMM,WAAWC,WAAWC,OACjD,SAAAC,GAAS,MAAqB,kBAAjBA,EAAUC,KACvB,GAEIP,EAAWQ,KAAKC,MAAMV,EAAeW,OAAOC,eAElDV,EAAUW,WAAaZ,EACpBK,OAAO,SAAAQ,GAAO,OAAIA,EAAQC,WAC1BC,IAAI,YAA+C,IAA5CnB,EAA4C,EAA5CA,SAAUoB,EAAkC,EAAlCA,iBAAkBrB,EAAgB,EAAhBA,UAClC,OAAO,EAAKsB,mBAAmB,CAC7BrB,WACAD,YACAD,YAAasB,EAAiB,oBAGjCE,KAAK,O,2CAIR,IAAMlB,EAAW,EAAIzB,SAAS4C,iBAAiB,uBACzCC,EAAsB,CAC1B,2BACA,4BAGFpB,EACGK,OAAO,SAAAQ,GACN,IAAMnB,EAAcmB,EAAQrC,cAAc,oBAE1C,OAAO4C,EAAoBC,SAAS3B,EAAYjB,eAEjD6C,QAAQ,SAAAT,GAAO,OAAIA,EAAQU,UAAUC,IAAI,c,kCAGlCC,EAAWC,GACrB,IAAMzB,EAAY1B,SAASoD,cAAc,OAezC,OAbA1B,EAAU2B,aAAa,QAAS,iBAEhC3B,EAAUW,UAAV,4FAEYa,EAFZ,qHAMYC,EANZ,uFAWOzB,I,gCAGCJ,EAAOC,GACf,IAMM+B,EAIAC,EAQAC,EAEAC,EAEAC,EAKAC,EA3BAC,EAAc5D,SAASC,cAAT,oCACWsB,EADX,wBAIfD,EAAMM,aAEL0B,EAAqBhC,EAAMM,WAAWC,WAAWC,OACrD,SAAAC,GAAS,MAAqB,oBAAjBA,EAAUC,KACvB,GAEIuB,EAAejC,EAAMM,WAAWC,WAAWC,OAC/C,SAAAC,GAAS,MAAqB,cAAjBA,EAAUC,KACvB,GAMIwB,EAJsBvB,KAAKC,MAC/BoB,EAAmBnB,OAAO0B,cAINC,qBAAqBC,eACrCN,EAAiBF,EAAapB,OAAO6B,MAErCN,EAAwBnE,KAAK0E,YACjC,iBACAR,GAAkB,WAGdE,EAA0BpE,KAAK0E,YACnC,gBACAT,GAGFI,EAAYM,aAAaR,EAAuBE,EAAYO,SAAS,IACrEP,EAAYM,aAAaP,EAAyBC,EAAYO,SAAS,O,sCAGzD7C,EAAOC,GACJvB,SAAS4C,iBAAT,oCACcrB,EADd,yBAIRwB,QAAQ,SAAAT,GACf,IAAMnB,EAAcmB,EAAQrC,cAAc,oBAEpCmE,EAAc9C,EAAM+C,MAAMvC,OAC9B,SAAAwC,GAAI,OAAIA,EAAKC,OAASpD,EAAYjB,cAClC,GAEFoC,EAAQe,aAAa,kBAAmBe,EAAYhD,WACpDkB,EAAQe,aAAa,mBAAoBe,EAAYpC,Q,mCAKpChC,SAAS4C,iBAAiB,mBAElCG,QAAQ,SAAAyB,GAAS,OAC1BA,EAAUxB,UAAUC,IAAI,4B,uCAIX3B,EAAOC,GACtB,IAMMgC,EAQEc,EAdFG,EAAYxE,SAASC,cAAT,oCACasB,EADb,OAIbD,EAAMM,YAOqB,aAL1B2B,EAAejC,EAAMM,WAAWC,WAAWC,OAC/C,SAAAC,GAAS,MAAqB,cAAjBA,EAAUC,KACvB,IAGaG,OAAOkC,OACU,SAA9Bd,EAAapB,OAAOkC,QAEdA,EAAQpC,KAAKC,MAAMqB,EAAapB,OAAOkC,OAE7CI,OAAOC,QAAQL,GAAOtB,QAAQ,YAAmC,aAAjC3B,EAAiC,KAAtBuD,EAAsB,KACzDrC,EAAUkC,EAAUvE,cAAV,4BACOmB,EADP,OAIVwD,EAAmB5E,SAASoD,cAAc,QAChDwB,EAAiBvB,aAAa,QAAS,6BACvCuB,EAAiB1E,YAAc,YAE/B,IAKQiB,EACA0D,EANFC,EAAgB9E,SAASoD,cAAc,QAC7C0B,EAAczB,aAAa,QAAS,qBACpCyB,EAAc5E,YAAd,wBAA6CyE,EAAiBI,yBAE1DzC,IAEIuC,GADA1D,EAAcmB,EAAQrC,cAAc,OACD0B,cAEzCR,EAAY6D,YAAYJ,GACxBC,EAAqBG,YAAYF,S,wCAMvBxD,EAAOC,GACvB,IAUQ0D,EAVFvD,EAAY1B,SAASC,cAAT,oCACasB,EADb,kCAIbD,EAAMM,aAMHqD,EAJa3D,EAAMM,WAAWC,WAAWC,OAC/C,SAAAC,GAAS,MAAqB,cAAjBA,EAAUC,KACvB,GAEmCG,OAA7B8C,YAERvD,EAAUW,WAAV,iEAGyB4C,EAChBC,MAAM,KACNC,UACAxC,KAAK,KANd,yC,0LAaApD,KAAK6F,oBAAoB,gBAAzB,2CAA0C,WAAO1E,EAAUF,GAAjB,0FACT,EAAIE,EAAS2E,YACzCvD,OAAO,SAAAwC,GAAI,OAAIA,aAAgBgB,UAC/BxD,OAAO,SAAAwC,GAAI,OAAIA,EAAKiB,QAAQ,iBAAgB,GAHP,OAQVvF,SAAS4C,iBACnC,mCAGkBG,QAAQ,SAAAyC,GAExBnG,EAAoBoG,eAAeD,EAAmBtF,aAEtDsF,EAAmBtF,YACjBb,EAAoBmG,EAAmBtF,aAEzCsF,EAAmB7D,cAAcA,cAAcA,cAAc+D,MAAMC,QACjE,SAIN,EAAKC,qBAECC,EA1BgC,EA2BjC7F,SAAS4C,iBAAiB,kCA3BO,SA8BjBkD,QAAQC,IAC3BF,EAAsBrD,IAAtB,2CAA0B,WAAM8B,GAAN,8FAClB0B,EAAU1B,EAAKpE,YAAY+F,QAAQ,WAAY,IAD7B,SAIhBC,MAAM,wBAAD,OAAyBF,IAJd,8BAKtBG,OALsB,cAGlBC,EAHkB,yBAOjBA,GAPiB,yCAA1B,wDA/BoC,uBA8BhCC,EA9BgC,QA0CtC,EAAK3G,WAAa2G,GAEXtD,QAAQ,SAACzB,EAAOgF,GACrB,EAAKC,gBAAgBjF,EAAOgF,EAAQ,GACpC,EAAKE,kBAAkBlF,EAAOgF,EAAQ,GACtC,EAAKG,iBAAiBnF,EAAOgF,EAAQ,GACrC,EAAKI,iBAAiBpF,EAAOgF,EAAQ,GACrC,EAAKK,UAAUrF,EAAOgF,EAAQ,KAGhC,EAAKM,aApDiC,0CAA1C,oCAAArH,KAAA,gB,8HAyDW,WACXS,SACGC,cAAc,4CACdI,iBAAiB,QAAS,SAAAC,GAAC,OAC1B,EAAKR,kD,gCAKbE,SAASK,iBAAiB,mBAAoB,WAC5C,IAAIf,K","file":"js/b8one.desktop.account.js","sourcesContent":["// import Home from '../home';\r\n\r\nconst VTEX_STATUS_TO_SHOW = {\r\n  'Preparando Entrega': 'Pedido Recebido',\r\n  'Pagamento Aprovado': 'Pagamento Aprovado',\r\n  'Preparando Pedido': 'Pedido Confirmado.',\r\n  'Cancelamento Solicitado': 'Cancelado',\r\n};\r\n\r\nclass Account {\r\n  constructor() {\r\n    this.changePageTitle();\r\n    this.setHandledsToWindow();\r\n\r\n    this.userOrders = [];\r\n\r\n    this.setHandled();\r\n\r\n    if (location.hash === '#/orders') {\r\n      this.fetchUserOrdersAndUpdateTheOrderElements();\r\n    }\r\n  }\r\n\r\n  setPageTitle(title) {\r\n    const pageHeaderTitle = document.querySelector(\r\n      '.vtex-account__page .vtex-pageHeader__title'\r\n    );\r\n\r\n    pageHeaderTitle.textContent = title;\r\n  }\r\n\r\n  changePageTitle() {\r\n    if (location.hash === '#/orders') {\r\n      this.setPageTitle('Minhas mudanças');\r\n    }\r\n  }\r\n\r\n  setHandledsToWindow() {\r\n    window.addEventListener('hashchange', e => this.changePageTitle());\r\n  }\r\n\r\n  // Callback function to execute when mutations are observed\r\n  observeCallback(mutationsList, observer, callback) {\r\n    for (let mutation of mutationsList) {\r\n      if (mutation.type === 'childList') {\r\n        callback(mutation, observer);\r\n      }\r\n    }\r\n  }\r\n\r\n  observeOrderSection(target, callback) {\r\n    // Select the node that will be observed for mutations\r\n    const targetNode = document.querySelector(target);\r\n\r\n    // Options for the observer (which mutations to observe)\r\n    const config = { childList: true, subtree: true };\r\n\r\n    // Create an observer instance linked to the callback function\r\n    const observer = new MutationObserver((mutationsList, observer) =>\r\n      this.observeCallback(mutationsList, observer, callback)\r\n    );\r\n\r\n    // Start observing the target node for configured mutations\r\n    observer.observe(targetNode, config);\r\n  }\r\n\r\n  createOrderProduct({ productName, productId, quantity }) {\r\n    return `\r\n      <div class=\"myo-order-product w-100 pb2 pt2 overflow-y-hidden\" data-product-id=\"${productId}\">\r\n        <div class=\"v-top dib w-20 h-auto\">\r\n          <img \r\n            src=\"/arquivos/ids/155403-50-50\"\r\n            alt=\"Item de 0,1 m³ sem caixa\" \r\n            crossorigin=\"anonymous\"\r\n          />\r\n        </div>\r\n        \r\n        <div class=\"dib w-80 pl3 c-on-base f6 fw4 lh-copy\">\r\n          <h4 class=\"db mb1 mt0\">\r\n            <a \r\n              href=\"/custom-item-1/p\"\r\n              class=\"c-link hover-c-link c-link--visited fw4 f6 f5-l link\"\r\n              target=\"_blank\" \r\n              rel=\"noopener\"\r\n            >\r\n              ${productName}\r\n            </a>\r\n          </h4>\r\n          \r\n          <span class=\"db mt0 mb2 f6 fw6\">\r\n            ${quantity} un.\r\n          </span>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  addOrderProducts(order, orderIndex) {\r\n    const firstProduct = document.querySelector(\r\n      `.myo-order-card:nth-child(${orderIndex}) .myo-order-product`\r\n    );\r\n    const container = firstProduct.parentElement;\r\n\r\n    if (!order.customData) return;\r\n\r\n    const selectItemsApp = order.customData.customApps.filter(\r\n      customApp => customApp.id === 'selecteditems'\r\n    )[0];\r\n\r\n    const products = JSON.parse(selectItemsApp.fields.products_data);\r\n\r\n    container.innerHTML += products\r\n      .filter(product => product.isCustom)\r\n      .map(({ quantity, customAttributes, productId }) => {\r\n        return this.createOrderProduct({\r\n          quantity,\r\n          productId,\r\n          productName: customAttributes['product-name'],\r\n        });\r\n      })\r\n      .join('');\r\n  }\r\n\r\n  hideCustomProducts() {\r\n    const products = [...document.querySelectorAll('.myo-order-product')];\r\n    const customProductsNames = [\r\n      'Item de 0,1 m³ sem caixa',\r\n      'Item de 0,1 m³ com caixa',\r\n    ];\r\n\r\n    products\r\n      .filter(product => {\r\n        const productName = product.querySelector('h4 a[href$=\"/p\"]');\r\n\r\n        return customProductsNames.includes(productName.textContent);\r\n      })\r\n      .forEach(product => product.classList.add('hidden'));\r\n  }\r\n\r\n  createTotal(totalName, totalPrice) {\r\n    const container = document.createElement('div');\r\n\r\n    container.setAttribute('class', 'fr fl-ns w-50');\r\n\r\n    container.innerHTML = `\r\n      <div class=\"db w-100 f7 f6-xl fw4 c-muted-1 ttu tr tl-ns\">\r\n        <span>${totalName}</span>\r\n      </div>\r\n      \r\n      <div class=\"db w-100 f6 fw5 c-muted-1 tr tl-ns f5-l\">\r\n        <span>${totalPrice}</span>\r\n        <div class=\"absolute dn dib-ns ml3 mt2\"></div>\r\n      </div>\r\n    `;\r\n\r\n    return container;\r\n  }\r\n\r\n  addTotals(order, orderIndex) {\r\n    const orderHeader = document.querySelector(\r\n      `.myo-order-card:nth-child(${orderIndex}) .myo-order-header`\r\n    );\r\n\r\n    if (!order.customData) return;\r\n\r\n    const selectedCourierAPP = order.customData.customApps.filter(\r\n      customApp => customApp.id === 'selectedcourier'\r\n    )[0];\r\n\r\n    const insuranceAPP = order.customData.customApps.filter(\r\n      customApp => customApp.id === 'insurance'\r\n    )[0];\r\n\r\n    const transporterSelected = JSON.parse(\r\n      selectedCourierAPP.fields.courier_data\r\n    );\r\n\r\n    const transporterTotal =\r\n      transporterSelected.deliveryTypeSelected.priceFormatted;\r\n    const insuranceTotal = insuranceAPP.fields.total;\r\n\r\n    const insuranceTotalElement = this.createTotal(\r\n      'Total Segurado',\r\n      insuranceTotal || 'R$ 0,00'\r\n    );\r\n\r\n    const transporterTotalElement = this.createTotal(\r\n      'Total Mudança',\r\n      transporterTotal\r\n    );\r\n\r\n    orderHeader.insertBefore(insuranceTotalElement, orderHeader.children[1]);\r\n    orderHeader.insertBefore(transporterTotalElement, orderHeader.children[1]);\r\n  }\r\n\r\n  addIDToProducts(order, orderIndex) {\r\n    const products = document.querySelectorAll(\r\n      `.myo-order-card:nth-child(${orderIndex}) .myo-order-product`\r\n    );\r\n\r\n    products.forEach(product => {\r\n      const productName = product.querySelector('h4 a[href$=\"/p\"]');\r\n\r\n      const productItem = order.items.filter(\r\n        item => item.name === productName.textContent\r\n      )[0];\r\n\r\n      product.setAttribute('data-product-id', productItem.productId);\r\n      product.setAttribute('data-product-sku', productItem.id);\r\n    });\r\n  }\r\n\r\n  showOrders() {\r\n    const orderCards = document.querySelectorAll('.myo-order-card');\r\n\r\n    orderCards.forEach(orderCard =>\r\n      orderCard.classList.add('myo-order-card--show')\r\n    );\r\n  }\r\n\r\n  addInsuranceInfo(order, orderIndex) {\r\n    const orderCard = document.querySelector(\r\n      `.myo-order-card:nth-child(${orderIndex})`\r\n    );\r\n\r\n    if (!order.customData) return;\r\n\r\n    const insuranceAPP = order.customData.customApps.filter(\r\n      customApp => customApp.id === 'insurance'\r\n    )[0];\r\n\r\n    if (\r\n      insuranceAPP.fields.items !== 'skipped' &&\r\n      insuranceAPP.fields.items !== 'none'\r\n    ) {\r\n      const items = JSON.parse(insuranceAPP.fields.items);\r\n\r\n      Object.entries(items).forEach(([productId, productInsurance]) => {\r\n        const product = orderCard.querySelector(\r\n          `[data-product-id=\"${productId}\"]`\r\n        );\r\n\r\n        const labelInsuredItem = document.createElement('span');\r\n        labelInsuredItem.setAttribute('class', 'myo-order-product-insured');\r\n        labelInsuredItem.textContent = 'Asegurado';\r\n\r\n        const insuranceText = document.createElement('span');\r\n        insuranceText.setAttribute('class', 'db mt0 mb2 f6 fw6');\r\n        insuranceText.textContent = `Asegurado por ${productInsurance.totalInsuranceFormatted}`;\r\n\r\n        if (product) {\r\n          const productName = product.querySelector('h4');\r\n          const productInfoContainer = productName.parentElement;\r\n\r\n          productName.appendChild(labelInsuredItem);\r\n          productInfoContainer.appendChild(insuranceText);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  addDateOfDelivery(order, orderIndex) {\r\n    const container = document.querySelector(\r\n      `.myo-order-card:nth-child(${orderIndex}) .bg-base > div:nth-child(2)`\r\n    );\r\n\r\n    if (!order.customData) return;\r\n\r\n    const orderinfoApp = order.customData.customApps.filter(\r\n      customApp => customApp.id === 'orderinfo'\r\n    )[0];\r\n\r\n    const { moving_date } = orderinfoApp.fields;\r\n\r\n    container.innerHTML += `\r\n      <div>\r\n        <p>\r\n          Data da mudança: ${moving_date\r\n            .split('/')\r\n            .reverse()\r\n            .join('/')}\r\n        </p>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  async fetchUserOrdersAndUpdateTheOrderElements() {\r\n    this.observeOrderSection('.vtex-account', async (mutation, observer) => {\r\n      const vtexAccountPageElement = [...mutation.addedNodes]\r\n        .filter(item => item instanceof Element)\r\n        .filter(item => item.matches('section.ph0'))[0];\r\n\r\n      if (vtexAccountPageElement) {\r\n        // observer.disconnect();\r\n\r\n        const orderStatusElements = document.querySelectorAll(\r\n          '.myo-seller-order-id + div span'\r\n        );\r\n\r\n        orderStatusElements.forEach(orderStatusElement => {\r\n          if (\r\n            VTEX_STATUS_TO_SHOW.hasOwnProperty(orderStatusElement.textContent)\r\n          ) {\r\n            orderStatusElement.textContent =\r\n              VTEX_STATUS_TO_SHOW[orderStatusElement.textContent];\r\n          } else {\r\n            orderStatusElement.parentElement.parentElement.parentElement.style.display =\r\n              'none';\r\n          }\r\n        });\r\n\r\n        this.hideCustomProducts();\r\n\r\n        const sellerOrderIDElements = [\r\n          ...document.querySelectorAll('.myo-order-card .myo-order-id'),\r\n        ];\r\n\r\n        const orders = await Promise.all(\r\n          sellerOrderIDElements.map(async item => {\r\n            const orderID = item.textContent.replace(/(\\#|\\s)+/, '');\r\n\r\n            const data = await (\r\n              await fetch(`/api/oms/user/orders/${orderID}`)\r\n            ).json();\r\n\r\n            return data;\r\n          })\r\n        );\r\n\r\n        this.userOrders = orders;\r\n\r\n        orders.forEach((order, index) => {\r\n          this.addIDToProducts(order, index + 1);\r\n          this.addDateOfDelivery(order, index + 1);\r\n          this.addOrderProducts(order, index + 1);\r\n          this.addInsuranceInfo(order, index + 1);\r\n          this.addTotals(order, index + 1);\r\n        });\r\n\r\n        this.showOrders();\r\n      }\r\n    });\r\n  }\r\n\r\n  setHandled() {\r\n    document\r\n      .querySelector('.vtex-account_menu-link[href=\"#/orders\"]')\r\n      .addEventListener('click', e =>\r\n        this.fetchUserOrdersAndUpdateTheOrderElements()\r\n      );\r\n  }\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  new Account();\r\n});\r\n"],"sourceRoot":""}