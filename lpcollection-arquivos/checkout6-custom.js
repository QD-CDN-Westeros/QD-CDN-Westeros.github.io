/* Peterturkish - 05/10/2021 17:23:56 GMT */
"use strict";function checkoutSteps(){$(window).on("hashchange",function(e){if(window.location.hash=="#/cart"){$(".mz-header__checkout--steps li").removeClass("active");$("#sacola").addClass("active")}else if(window.location.hash=="#/email"||window.location.hash=="#/profile"){$(".mz-header__checkout--steps li").removeClass("active");$("#sacola").addClass("active");$("#identificacao").addClass("active")}else if(window.location.hash=="#/payment"){$(".mz-header__checkout--steps li").removeClass("active");$("#sacola").addClass("active");$("#identificacao").addClass("active");$("#pagamento").addClass("active")}else if(window.location.hash=="/orderPlaced"){$(".mz-header__checkout--steps li").removeClass("active");$("#sacola").addClass("active");$("#identificacao").addClass("active");$("#pagamento").addClass("active");$("#confirmacao").addClass("active")}})}checkoutSteps();$(document).ready(function(){if(location.href.indexOf("?dev=1")>0){$("body").addClass("teste");$(".newsletter-label").append("<span> "+'Estou de acordo com o uso de dados conforme <a href="#">Políticade Privacidade</a> do site</span>');$(".opt-in-newsletter, .newsletter-text").hide()}});$(document).ajaxStop(function(){if(location.href.indexOf("?dev=1")>0){$("#go-to-shipping").prop("disabled",true);$("#opt-in-newsletter").change(function(){if($(this).prop("checked")==true){$("#go-to-shipping").prop("disabled",false)}else{$("#go-to-shipping").prop("disabled",true)}})}});var birthDate={saveDataClick:function saveDataClick(){$("#go-to-shipping").off();$(document).on("click","#go-to-payment",function(event){birthDate.saveDate(event)})},watchInput:function watchInput(){$("#client-email").one().focusout(function(){$("#client-birthdate").val("")})},getDate:function getDate(){var infoLoop=setInterval(function(){var emailCliente;if($(".box-client-info-pf .client-email").find("span").text()==""){emailCliente=$(".client-profile-email .email").text()}else{emailCliente=$(".box-client-info .client-email").find("span").text()}$.ajax({url:"/api/dataentities/CL/search?email="+emailCliente+"&_fields=birthDate",type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=UTF-8"},success:function success(data){if(data.length){var userClInfo=data[0];if(!userClInfo.birthDate){if($(".client-birthdate").length<=0){birthDate.createFields()}}else{if($(".client-birthdate").length<=0){birthDate.createFields();var date=userClInfo.birthDate;var dataNascForm;date=date.replace("T00:00:00","");if(date.includes("-")){dataNascForm=date.split("-")}else{dataNascForm=date.split("/")}dataNascForm=dataNascForm[2]+"/"+dataNascForm[1]+"/"+dataNascForm[0];$("#client-birthdate").val(dataNascForm)}}}else{if(!$(".client-birthdate").length){birthDate.createFields()}}clearInterval(infoLoop);birthDate.watchInput()},error:function error(xhr,ajaxOptions,thrownError){alert("Error during user request");console.log(xhr,ajaxOptions);console.log(thrownError);clearInterval(infoLoop)}})},500)},createFields:function createFields(message){if($(".client-birthdate").length){return false}var field='<p class="client-birthdate input text required"> <label for="client-birthdate">Data de nascimento</label> <input type="text" id="client-birthdate" class="input-xlarge" name="birthdate" placeholder="00/00/0000" > <small>*O campo deve ser preenchido apenas com números.</small> </p>';$(".box-client-info .client-email.input, .box-client-info .client-email.text").after(field);$(".client-birthdate input").mask("00/00/0000");if(message){error='<span class="help error birthDate-error">Por favor, verifique se sua data de nascimento está correta.</span>';$("#client-birthdate").after(error)}},saveDate:function saveDate(e){var errorSave=sessionStorage.getItem("client-birthdate");if(!errorSave){e.preventDefault()}var dataNascObj=$(".box-client-info #client-birthdate");var dataNascForm,dataNasc;if(!dataNascObj.length){birthDate.createFields(true);return false}else{dataNasc=$(".box-client-info #client-birthdate").val()}dataNascForm=dataNasc.split("/");dataNascForm=dataNascForm[2]+"/"+dataNascForm[1]+"/"+dataNascForm[0]+"T00:00:00";emailCliente=$("#client-email").length?$("#client-email").val():$("#client-profile-data .box-client-info-pf .client-email span").text();var adicionaisFiels={birthDate:dataNascForm,email:emailCliente};$.ajax({accept:"application/vnd.vtex.ds.v10+json",contentType:"application/json; charset=utf-8",crossDomain:true,data:JSON.stringify(adicionaisFiels),type:"PATCH",url:"/api/dataentities/CL/documents",success:function success(data){$("form.form-step.box-edit").submit();window.location.hash="#/shipping"},error:function error(xhr,ajaxOptions,thrownError){var error,text;if(xhr.responseText.indexOf("DateTime")!=-1){console.log("Error on saving data",xhr,ajaxOptions,thrownError);$(".birthDate-error").remove();if(dataNascObj.length&&dataNasc.length<=0){text="Campo obrigatório."}else{text="Por favor, verifique se sua data de nascimento está correta."}error='<span class="help error birthDate-error">'+text+"</span>";$("#client-birthdate").after(error)}else{alert("Ocorreu um erro em salvar sua data de nascimento, por favor nos avise.");$("#drz_btn_open").trigger("click");sessionStorage.setItem("client-birthdate","error-save");window.location.hash="#/shipping"}}})},changeNumberInput:function changeNumberInput(){$(".input #ship-number").attr("maxLength",6)},changeReferalInput:function changeReferalInput(){$(".ship-reference #ship-reference, .ship-complement #ship-complement").focusin(function(){$(".ship-reference #ship-reference, .ship-complement #ship-complement").on("keydown",function(event){if(/[$&+,\]:;=?@{}#|['<>.´^"`´'*()%!\/-]/.test(event.originalEvent.key)){event.preventDefault()}})})}};$(document).ready(function(){var imported=document.createElement("script");imported.src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.js";document.head.appendChild(imported);$(window).load(function(){$(document).ajaxStop(function(){birthDate.changeNumberInput();birthDate.changeReferalInput()});if(window.location.hash==="#/profile"){birthDate.getDate();birthDate.saveDataClick()}if(window.location.hash==="#/shipping"){birthDate.changeNumberInput();birthDate.changeReferalInput()}});$(window).on("hashchange",function(){birthDate.changeNumberInput();birthDate.changeReferalInput();if(window.location.hash==="#/profile"){birthDate.getDate();birthDate.saveDataClick()}})});